<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lin de Cubel - Gesti√≥n del Club</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&display=swap');
        body { font-family: 'Orbitron', sans-serif; background-color: #f8faf9; letter-spacing: 0.02em; }
        .bg-corp-primary { background-color: #a4c639 !important; }
        .bg-corp-dark { background-color: #8fb02e !important; }
        .bg-corp-secondary { background-color: #2d2d2d !important; }
        .bg-corp-bg-light { background-color: #f0f7e6 !important; }
        .bg-corp-bg-pale { background-color: #e6f2c9 !important; }
        .text-corp-primary { color: #a4c639 !important; }
        .text-corp-secondary { color: #2d2d2d !important; }
        .border-corp-primary { border-color: #a4c639 !important; }
        .btn-primary { background-color: #a4c639; color: white; transition: all 0.3s; }
        .btn-primary:hover { background-color: #8fb02e; }
        .btn-secondary { background-color: #2d2d2d; color: white; transition: all 0.3s; }
        .btn-secondary:hover { background-color: #1a1a1a; }
    </style>
    <meta name="theme-color" content="#a4c639">
    <meta name="description" content="Sistema de gesti√≥n del Club Ciclista Lin de Cubel">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 200 200'><rect fill='%23a4c639' width='200' height='200'/><circle cx='60' cy='100' r='35' fill='none' stroke='white' stroke-width='12'/><circle cx='140' cy='100' r='35' fill='none' stroke='white' stroke-width='12'/><path d='M 85 75 Q 100 60 115 75' fill='none' stroke='white' stroke-width='12' stroke-linecap='round'/></svg>">
    <script>
        const manifest = { name: "Lin de Cubel", short_name: "Lin de Cubel", start_url: "./", display: "standalone", background_color: "#f8faf9", theme_color: "#a4c639", icons: [{ src: "data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 200 200'><rect fill='%23a4c639' width='200' height='200'/><circle cx='60' cy='100' r='35' fill='none' stroke='white' stroke-width='12'/><circle cx='140' cy='100' r='35' fill='none' stroke='white' stroke-width='12'/><path d='M 85 75 Q 100 60 115 75' fill='none' stroke='white' stroke-width='12' stroke-linecap='round'/></svg>", sizes: "any", type: "image/svg+xml" }] };
        const blob = new Blob([JSON.stringify(manifest)], {type: 'application/json'});
        document.write('<link rel="manifest" href="' + URL.createObjectURL(blob) + '">');
    </script>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect } = React;
        const SUPABASE_URL = 'https://shyfjclxlnygysubehus.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNoeWZqY2x4bG55Z3lzdWJlaHVzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAwMTYxMTcsImV4cCI6MjA4NTU5MjExN30.G3yt-lH_ef4n1qclC3Z54Cbj_n4bWOkfWvOMqJ22uEE';
        const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        const ADMIN_PASSWORD = 'lindecubel2025';

        function ClubCiclistaApp() {
            const [session, setSession] = useState(null);
            const [loading, setLoading] = useState(true);
            const [isAdmin, setIsAdmin] = useState(false);
            const [currentSocio, setCurrentSocio] = useState(null);
            const [activeTab, setActiveTab] = useState('socios');
            const [loginView, setLoginView] = useState('select');
            const [loginForm, setLoginForm] = useState({ email: '', password: '' });
            const [registerForm, setRegisterForm] = useState({ email: '', password: '', nombre: '', apellidos: '', dni: '', telefono: '', fechaNacimiento: '', direccion: '' });
            const [socios, setSocios] = useState([]);
            const [salidas, setSalidas] = useState([]);
            const [productos, setProductos] = useState([]);
            const [inscripciones, setInscripciones] = useState([]);
            const [carrito, setCarrito] = useState([]);
            const [stravaClientId, setStravaClientId] = useState(localStorage.getItem('strava_client_id') || '');
            const [stravaClientSecret, setStravaClientSecret] = useState(localStorage.getItem('strava_client_secret') || '');
            const [mostrarConfigStrava, setMostrarConfigStrava] = useState(false);
            const [stravaStats, setStravaStats] = useState([]);
            const [nuevaSalida, setNuevaSalida] = useState({ nombre: '', fecha: '', hora: '', distancia: '', desnivel: '', nivel: 'Intermedio', punto_encuentro: '' });
            const [mostrarFormSalida, setMostrarFormSalida] = useState(false);

            useEffect(() => {
                supabase.auth.getSession().then(({ data: { session } }) => {
                    setSession(session);
                    if (session) loadUserData(session.user);
                    setLoading(false);
                });
                const { data: { subscription } } = supabase.auth.onAuthStateChange((_event, session) => {
                    setSession(session);
                    if (session) loadUserData(session.user);
                    else { setCurrentSocio(null); setIsAdmin(false); }
                });
                return () => subscription.unsubscribe();
            }, []);

            const loadUserData = async (user) => {
                const { data } = await supabase.from('socios').select('*').eq('user_id', user.id).single();
                if (data) setCurrentSocio(data);
            };

            useEffect(() => { if (session) loadAllData(); }, [session]);

            const loadAllData = async () => {
                const { data: sociosData } = await supabase.from('socios').select('*').order('created_at', { ascending: false });
                if (sociosData) setSocios(sociosData);
                const { data: salidasData } = await supabase.from('salidas').select('*').order('fecha', { ascending: false });
                if (salidasData) setSalidas(salidasData);
                const { data: productosData } = await supabase.from('productos').select('*');
                if (productosData) setProductos(productosData);
                const { data: inscripcionesData } = await supabase.from('inscripciones').select('*');
                if (inscripcionesData) setInscripciones(inscripcionesData);
                const { data: stravaData } = await supabase.from('strava_stats').select('*, socios(nombre, apellidos)');
                if (stravaData) setStravaStats(stravaData);
            };

            const loginAdmin = () => {
                if (loginForm.password === ADMIN_PASSWORD) {
                    setIsAdmin(true);
                    setSession({ user: { email: 'admin' } });
                    setLoginView('select');
                    alert('¬°Bienvenido Administrador!');
                } else alert('Contrase√±a incorrecta');
            };

            const loginSocio = async () => {
                const { error } = await supabase.auth.signInWithPassword({ email: loginForm.email, password: loginForm.password });
                if (error) alert('Error: ' + error.message);
                else { alert('¬°Bienvenido!'); setLoginView('select'); }
            };

            const registerSocio = async () => {
                if (!registerForm.email || !registerForm.password || !registerForm.nombre || !registerForm.apellidos || !registerForm.dni) {
                    alert('Completa los campos obligatorios');
                    return;
                }
                const { data: authData, error: authError } = await supabase.auth.signUp({ email: registerForm.email, password: registerForm.password });
                if (authError) { alert('Error: ' + authError.message); return; }
                const { error: socioError } = await supabase.from('socios').insert([{
                    user_id: authData.user.id, nombre: registerForm.nombre, apellidos: registerForm.apellidos,
                    dni: registerForm.dni, telefono: registerForm.telefono, fecha_nacimiento: registerForm.fechaNacimiento,
                    email: registerForm.email, direccion: registerForm.direccion, cuota_pagada: false
                }]);
                if (socioError) alert('Error: ' + socioError.message);
                else {
                    alert('¬°Registro exitoso!');
                    setLoginView('socio');
                    setRegisterForm({ email: '', password: '', nombre: '', apellidos: '', dni: '', telefono: '', fechaNacimiento: '', direccion: '' });
                }
            };

            const logout = async () => {
                if (isAdmin) { setIsAdmin(false); setSession(null); }
                else await supabase.auth.signOut();
                setActiveTab('socios');
            };

            const pagarCuota = async (socioId) => {
                const { error } = await supabase.from('socios').update({ cuota_pagada: true, fecha_pago: new Date().toISOString().split('T')[0] }).eq('id', socioId);
                if (error) alert('Error: ' + error.message);
                else { alert('Cuota de 20‚Ç¨ marcada como pagada'); loadAllData(); }
            };

            const crearSalida = async () => {
                if (!isAdmin) return;
                if (!nuevaSalida.nombre || !nuevaSalida.fecha || !nuevaSalida.hora) {
                    alert('Completa los campos obligatorios');
                    return;
                }
                const { error } = await supabase.from('salidas').insert([{
                    nombre: nuevaSalida.nombre,
                    fecha: nuevaSalida.fecha,
                    hora: nuevaSalida.hora,
                    distancia: parseInt(nuevaSalida.distancia) || 0,
                    desnivel: parseInt(nuevaSalida.desnivel) || 0,
                    nivel: nuevaSalida.nivel,
                    punto_encuentro: nuevaSalida.punto_encuentro
                }]);
                if (error) alert('Error: ' + error.message);
                else {
                    alert('Salida creada');
                    setNuevaSalida({ nombre: '', fecha: '', hora: '', distancia: '', desnivel: '', nivel: 'Intermedio', punto_encuentro: '' });
                    setMostrarFormSalida(false);
                    loadAllData();
                }
            };

            const inscribirseASalida = async (salidaId) => {
                if (!currentSocio) return;
                const { error } = await supabase.from('inscripciones').insert([{ salida_id: salidaId, socio_id: currentSocio.id }]);
                if (error) {
                    if (error.code === '23505') alert('Ya est√°s inscrito');
                    else alert('Error: ' + error.message);
                } else { alert('¬°Inscripci√≥n realizada!'); loadAllData(); }
            };

            const desinscribirseASalida = async (salidaId) => {
                if (!currentSocio) return;
                const { error } = await supabase.from('inscripciones').delete().eq('salida_id', salidaId).eq('socio_id', currentSocio.id);
                if (error) alert('Error: ' + error.message);
                else { alert('Desinscripci√≥n realizada'); loadAllData(); }
            };

            const eliminarSalida = async (salidaId) => {
                if (!isAdmin || !confirm('¬øEliminar esta salida?')) return;
                const { error } = await supabase.from('salidas').delete().eq('id', salidaId);
                if (error) alert('Error: ' + error.message);
                else { alert('Salida eliminada'); loadAllData(); }
            };

            const agregarAlCarrito = (producto, talla) => {
                const stockField = `stock_${talla.toLowerCase()}`;
                if (producto[stockField] > 0) {
                    setCarrito([...carrito, { ...producto, talla, productoId: producto.id }]);
                    alert(`${producto.nombre} a√±adido`);
                } else alert('Sin stock');
            };

            const eliminarDelCarrito = (index) => setCarrito(carrito.filter((_, i) => i !== index));

            const procesarCompra = async () => {
                if (carrito.length === 0) return;
                for (const item of carrito) {
                    const stockField = `stock_${item.talla.toLowerCase()}`;
                    const producto = productos.find(p => p.id === item.productoId);
                    await supabase.from('productos').update({ [stockField]: producto[stockField] - 1 }).eq('id', item.productoId);
                }
                const total = carrito.reduce((sum, item) => sum + item.precio, 0);
                await supabase.from('compras').insert([{ socio_id: currentSocio?.id, total, items: JSON.stringify(carrito) }]);
                alert(`Compra procesada: ${total}‚Ç¨`);
                setCarrito([]);
                loadAllData();
            };

            const guardarCredencialesStrava = () => {
                localStorage.setItem('strava_client_id', stravaClientId);
                localStorage.setItem('strava_client_secret', stravaClientSecret);
                setMostrarConfigStrava(false);
                alert('Credenciales guardadas');
            };

            const conectarConStrava = () => {
                if (!stravaClientId) { alert('Configura credenciales primero'); setMostrarConfigStrava(true); return; }
                const scope = 'read,activity:read_all,profile:read_all';
                const redirectUri = window.location.origin + window.location.pathname;
                window.location.href = `https://www.strava.com/oauth/authorize?client_id=${stravaClientId}&response_type=code&redirect_uri=${encodeURIComponent(redirectUri)}&approval_prompt=force&scope=${scope}`;
            };

            const sincronizarStrava = async () => {
                if (!currentSocio?.strava_access_token) { alert('Primero conecta con Strava'); return; }
                try {
                    const athleteRes = await fetch('https://www.strava.com/api/v3/athlete', {
                        headers: { 'Authorization': `Bearer ${currentSocio.strava_access_token}` }
                    });
                    const athlete = await athleteRes.json();
                    const statsRes = await fetch(`https://www.strava.com/api/v3/athletes/${athlete.id}/stats`, {
                        headers: { 'Authorization': `Bearer ${currentSocio.strava_access_token}` }
                    });
                    const stats = await statsRes.json();
                    const kmMes = Math.round((stats.recent_ride_totals?.distance || 0) / 1000);
                    const kmAno = Math.round((stats.ytd_ride_totals?.distance || 0) / 1000);
                    const desnivelMes = Math.round(stats.recent_ride_totals?.elevation_gain || 0);
                    const salidasMes = stats.recent_ride_totals?.count || 0;
                    await supabase.from('strava_stats').upsert([{
                        socio_id: currentSocio.id, km_mes: kmMes, km_ano: kmAno,
                        desnivel_mes: desnivelMes, salidas_mes: salidasMes
                    }], { onConflict: 'socio_id' });
                    alert(`Sincronizado!\nKm mes: ${kmMes}\nKm a√±o: ${kmAno}`);
                    loadAllData();
                } catch (error) {
                    alert('Error: ' + error.message);
                }
            };

            if (loading) {
                return <div className="min-h-screen flex items-center justify-center bg-corp-primary">
                    <div className="text-white text-2xl">Cargando...</div>
                </div>;
            }

            if (!session) {
                return (
                    <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-corp-primary to-corp-dark">
                        <div className="bg-white rounded-lg shadow-2xl p-8 max-w-md w-full mx-4">
                            <div className="text-center mb-8">
                                <svg width="100" height="100" viewBox="0 0 200 200" className="mx-auto mb-4">
                                    <circle cx="60" cy="100" r="35" fill="none" stroke="#a4c639" strokeWidth="12"/>
                                    <circle cx="140" cy="100" r="35" fill="none" stroke="#a4c639" strokeWidth="12"/>
                                    <path d="M 85 75 Q 100 60 115 75" fill="none" stroke="#a4c639" strokeWidth="12" strokeLinecap="round"/>
                                </svg>
                                <h1 className="text-3xl font-bold text-corp-secondary mb-2">LIN DE CUBEL</h1>
                                <p className="text-gray-600">Sistema de Gesti√≥n del Club</p>
                            </div>
                            {loginView === 'select' && (
                                <div className="space-y-4">
                                    <button onClick={() => setLoginView('admin')} className="w-full btn-primary px-4 py-3 rounded font-semibold">üîê Administrador</button>
                                    <button onClick={() => setLoginView('socio')} className="w-full btn-secondary px-4 py-3 rounded font-semibold">üë§ Soy Socio</button>
                                    <button onClick={() => setLoginView('register')} className="w-full border-2 border-corp-primary text-corp-primary px-4 py-3 rounded font-semibold hover:bg-corp-bg-pale">‚ú® Registrarme</button>
                                </div>
                            )}
                            {loginView === 'admin' && (
                                <div>
                                    <h2 className="text-xl font-bold mb-4">üîê Login Administrador</h2>
                                    <input type="password" placeholder="Contrase√±a" value={loginForm.password}
                                        onChange={(e) => setLoginForm({...loginForm, password: e.target.value})}
                                        onKeyPress={(e) => e.key === 'Enter' && loginAdmin()}
                                        className="w-full border rounded px-4 py-3 mb-3"/>
                                    <div className="flex gap-2">
                                        <button onClick={loginAdmin} className="flex-1 btn-primary px-4 py-3 rounded">Entrar</button>
                                        <button onClick={() => setLoginView('select')} className="px-4 py-3 rounded border">Volver</button>
                                    </div>
                                </div>
                            )}
                            {loginView === 'socio' && (
                                <div>
                                    <h2 className="text-xl font-bold mb-4">üë§ Login Socio</h2>
                                    <input type="email" placeholder="Email" value={loginForm.email}
                                        onChange={(e) => setLoginForm({...loginForm, email: e.target.value})}
                                        className="w-full border rounded px-4 py-3 mb-3"/>
                                    <input type="password" placeholder="Contrase√±a" value={loginForm.password}
                                        onChange={(e) => setLoginForm({...loginForm, password: e.target.value})}
                                        onKeyPress={(e) => e.key === 'Enter' && loginSocio()}
                                        className="w-full border rounded px-4 py-3 mb-3"/>
                                    <div className="flex gap-2">
                                        <button onClick={loginSocio} className="flex-1 btn-secondary px-4 py-3 rounded">Entrar</button>
                                        <button onClick={() => setLoginView('select')} className="px-4 py-3 rounded border">Volver</button>
                                    </div>
                                </div>
                            )}
                            {loginView === 'register' && (
                                <div>
                                    <h2 className="text-xl font-bold mb-4">‚ú® Registro</h2>
                                    <div className="space-y-3 max-h-96 overflow-y-auto">
                                        <input type="email" placeholder="Email *" value={registerForm.email}
                                            onChange={(e) => setRegisterForm({...registerForm, email: e.target.value})}
                                            className="w-full border rounded px-4 py-2"/>
                                        <input type="password" placeholder="Contrase√±a *" value={registerForm.password}
                                            onChange={(e) => setRegisterForm({...registerForm, password: e.target.value})}
                                            className="w-full border rounded px-4 py-2"/>
                                        <input type="text" placeholder="Nombre *" value={registerForm.nombre}
                                            onChange={(e) => setRegisterForm({...registerForm, nombre: e.target.value})}
                                            className="w-full border rounded px-4 py-2"/>
                                        <input type="text" placeholder="Apellidos *" value={registerForm.apellidos}
                                            onChange={(e) => setRegisterForm({...registerForm, apellidos: e.target.value})}
                                            className="w-full border rounded px-4 py-2"/>
                                        <input type="text" placeholder="DNI *" value={registerForm.dni}
                                            onChange={(e) => setRegisterForm({...registerForm, dni: e.target.value})}
                                            className="w-full border rounded px-4 py-2"/>
                                        <input type="tel" placeholder="Tel√©fono" value={registerForm.telefono}
                                            onChange={(e) => setRegisterForm({...registerForm, telefono: e.target.value})}
                                            className="w-full border rounded px-4 py-2"/>
                                        <input type="date" value={registerForm.fechaNacimiento}
                                            onChange={(e) => setRegisterForm({...registerForm, fechaNacimiento: e.target.value})}
                                            className="w-full border rounded px-4 py-2"/>
                                        <input type="text" placeholder="Direcci√≥n" value={registerForm.direccion}
                                            onChange={(e) => setRegisterForm({...registerForm, direccion: e.target.value})}
                                            className="w-full border rounded px-4 py-2"/>
                                    </div>
                                    <p className="text-xs text-gray-500 my-2">* Obligatorios</p>
                                    <div className="flex gap-2 mt-4">
                                        <button onClick={registerSocio} className="flex-1 btn-primary px-4 py-3 rounded">Registrarse</button>
                                        <button onClick={() => setLoginView('select')} className="px-4 py-3 rounded border">Volver</button>
                                    </div>
                                    <div className="mt-4 p-3 bg-blue-50 rounded text-sm">
                                        <p className="font-semibold mb-1">üí∞ Cuota: 20‚Ç¨</p>
                                        <p className="text-xs">Tras registrarte, realiza transferencia y contacta al admin.</p>
                                    </div>
                                </div>
                            )}
                            <p className="text-xs text-gray-500 text-center mt-6">¬© 2025 Lin de Cubel</p>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-gray-50">
                    <header className="bg-corp-primary text-white shadow-lg">
                        <div className="container mx-auto px-4 py-4">
                            <div className="flex items-center justify-between">
                                <div className="flex items-center gap-4">
                                    <svg width="50" height="50" viewBox="0 0 200 200">
                                        <circle cx="60" cy="100" r="35" fill="none" stroke="white" strokeWidth="12"/>
                                        <circle cx="140" cy="100" r="35" fill="none" stroke="white" strokeWidth="12"/>
                                        <path d="M 85 75 Q 100 60 115 75" fill="none" stroke="white" strokeWidth="12" strokeLinecap="round"/>
                                    </svg>
                                    <div>
                                        <h1 className="text-2xl font-bold">LIN DE CUBEL</h1>
                                        <p className="text-sm opacity-90">Club Ciclista</p>
                                    </div>
                                </div>
                                <div className="flex items-center gap-3">
                                    <div className="text-right">
                                        <p className="text-sm font-semibold">{isAdmin ? 'Administrador' : currentSocio ? `${currentSocio.nombre} ${currentSocio.apellidos}` : 'Usuario'}</p>
                                        <p className="text-xs opacity-75">{isAdmin ? 'üîê Admin' : 'üë§ Socio'}</p>
                                    </div>
                                    <button onClick={logout} className="bg-red-600 px-4 py-2 rounded text-sm hover:bg-red-700">Salir</button>
                                </div>
                            </div>
                        </div>
                    </header>
                    
                    <nav className="bg-white shadow-md sticky top-0 z-10">
                        <div className="container mx-auto px-4">
                            <div className="flex gap-1">
                                {['socios', 'salidas', 'tienda', 'strava'].map(tab => (
                                    <button key={tab} onClick={() => setActiveTab(tab)}
                                        className={`px-6 py-3 font-semibold transition ${activeTab === tab ? 'border-b-4 border-corp-primary text-corp-primary' : 'text-gray-600 hover:text-corp-primary'}`}>
                                        {tab === 'socios' && 'üë• Socios'}
                                        {tab === 'salidas' && 'üö¥ Salidas'}
                                        {tab === 'tienda' && 'üõí Tienda'}
                                        {tab === 'strava' && 'üìä Strava'}
                                    </button>
                                ))}
                            </div>
                        </div>
                    </nav>
                    
                    <main className="container mx-auto px-4 py-8">
                        {activeTab === 'socios' && (
                            <div className="bg-white rounded-lg shadow p-6">
                                <h2 className="text-2xl font-bold mb-4">Socios del Club</h2>
                                <div className="mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                                    <h3 className="font-semibold text-lg mb-3">üí∞ Informaci√≥n de Pago</h3>
                                    <div className="grid md:grid-cols-2 gap-4 text-sm">
                                        <div>
                                            <p className="mb-2">Cuota anual: <span className="text-corp-primary text-xl font-bold">20‚Ç¨</span></p>
                                            <p className="mb-1"><strong>üè¶ Transferencia:</strong></p>
                                            <p className="font-mono text-sm bg-white px-3 py-2 rounded border">ES07 3059 0021 4429 2850 5722</p>
                                        </div>
                                        <div>
                                            <p className="font-semibold mb-2">Concepto:</p>
                                            <p className="bg-white px-3 py-2 rounded border">Cuota [Tu Nombre]</p>
                                            <p className="text-xs text-gray-500 mt-2">Tras pagar, contacta al administrador</p>
                                        </div>
                                    </div>
                                </div>
                                <table className="w-full">
                                    <thead className="bg-gray-100">
                                        <tr>
                                            <th className="px-4 py-2 text-left">Nombre</th>
                                            <th className="px-4 py-2 text-left">Email</th>
                                            <th className="px-4 py-2 text-left">DNI</th>
                                            <th className="px-4 py-2 text-left">Cuota</th>
                                            {isAdmin && <th className="px-4 py-2 text-left">Acciones</th>}
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {socios.filter(s => isAdmin || s.id === currentSocio?.id).map(socio => (
                                            <tr key={socio.id} className="border-b">
                                                <td className="px-4 py-3">{socio.nombre} {socio.apellidos}</td>
                                                <td className="px-4 py-3">{socio.email}</td>
                                                <td className="px-4 py-3">{socio.dni}</td>
                                                <td className="px-4 py-3">
                                                    {socio.cuota_pagada ? (
                                                        <span className="bg-green-100 text-green-800 px-2 py-1 rounded text-sm">‚úì Pagada {socio.fecha_pago && `(${socio.fecha_pago})`}</span>
                                                    ) : (
                                                        <span className="bg-yellow-100 text-yellow-800 px-2 py-1 rounded text-sm">‚è≥ Pendiente</span>
                                                    )}
                                                </td>
                                                {isAdmin && (
                                                    <td className="px-4 py-3">
                                                        {!socio.cuota_pagada && (
                                                            <button onClick={() => pagarCuota(socio.id)} className="btn-primary px-3 py-1 rounded text-sm">Marcar Pagada</button>
                                                        )}
                                                    </td>
                                                )}
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        )}
                        
                        {activeTab === 'salidas' && (
                            <div className="bg-white rounded-lg shadow p-6">
                                <div className="flex justify-between items-center mb-4">
                                    <h2 className="text-2xl font-bold">Salidas Programadas</h2>
                                    {isAdmin && (
                                        <button onClick={() => setMostrarFormSalida(!mostrarFormSalida)} className="btn-primary px-4 py-2 rounded">
                                            {mostrarFormSalida ? '‚úï Cancelar' : '‚ûï Nueva Salida'}
                                        </button>
                                    )}
                                </div>
                                
                                {mostrarFormSalida && isAdmin && (
                                    <div className="mb-6 p-4 bg-corp-bg-pale rounded-lg">
                                        <h3 className="font-bold mb-3">Crear Nueva Salida</h3>
                                        <div className="grid md:grid-cols-2 gap-3">
                                            <input type="text" placeholder="Nombre de la salida *" value={nuevaSalida.nombre}
                                                onChange={(e) => setNuevaSalida({...nuevaSalida, nombre: e.target.value})}
                                                className="border rounded px-3 py-2"/>
                                            <input type="date" value={nuevaSalida.fecha}
                                                onChange={(e) => setNuevaSalida({...nuevaSalida, fecha: e.target.value})}
                                                className="border rounded px-3 py-2"/>
                                            <input type="time" value={nuevaSalida.hora}
                                                onChange={(e) => setNuevaSalida({...nuevaSalida, hora: e.target.value})}
                                                className="border rounded px-3 py-2"/>
                                            <input type="number" placeholder="Distancia (km)" value={nuevaSalida.distancia}
                                                onChange={(e) => setNuevaSalida({...nuevaSalida, distancia: e.target.value})}
                                                className="border rounded px-3 py-2"/>
                                            <input type="number" placeholder="Desnivel (m)" value={nuevaSalida.desnivel}
                                                onChange={(e) => setNuevaSalida({...nuevaSalida, desnivel: e.target.value})}
                                                className="border rounded px-3 py-2"/>
                                            <select value={nuevaSalida.nivel}
                                                onChange={(e) => setNuevaSalida({...nuevaSalida, nivel: e.target.value})}
                                                className="border rounded px-3 py-2">
                                                <option>Principiante</option>
                                                <option>Intermedio</option>
                                                <option>Avanzado</option>
                                            </select>
                                            <input type="text" placeholder="Punto de encuentro" value={nuevaSalida.punto_encuentro}
                                                onChange={(e) => setNuevaSalida({...nuevaSalida, punto_encuentro: e.target.value})}
                                                className="border rounded px-3 py-2 md:col-span-2"/>
                                        </div>
                                        <button onClick={crearSalida} className="btn-primary px-6 py-2 rounded mt-3">Crear Salida</button>
                                    </div>
                                )}
                                
                                <div className="space-y-4">
                                    {salidas.map(salida => {
                                        const inscritos = inscripciones.filter(i => i.salida_id === salida.id);
                                        const estaInscrito = inscritos.some(i => i.socio_id === currentSocio?.id);
                                        return (
                                            <div key={salida.id} className="border rounded-lg p-4">
                                                <div className="flex justify-between items-start mb-3">
                                                    <div>
                                                        <h3 className="text-xl font-bold">{salida.nombre}</h3>
                                                        <p className="text-gray-600">üìÖ {salida.fecha} ‚Ä¢ ‚è∞ {salida.hora}</p>
                                                    </div>
                                                    {isAdmin && (
                                                        <button onClick={() => eliminarSalida(salida.id)} className="text-red-600 hover:bg-red-50 px-3 py-1 rounded">üóëÔ∏è</button>
                                                    )}
                                                </div>
                                                <div className="grid md:grid-cols-3 gap-4 mb-3 text-sm">
                                                    {salida.distancia > 0 && <p>üìè Distancia: {salida.distancia} km</p>}
                                                    {salida.desnivel > 0 && <p>‚õ∞Ô∏è Desnivel: {salida.desnivel} m</p>}
                                                    <p>üèÅ Nivel: {salida.nivel}</p>
                                                </div>
                                                {salida.punto_encuentro && <p className="text-sm mb-3">üìç {salida.punto_encuentro}</p>}
                                                <div className="flex items-center justify-between">
                                                    <p className="text-sm">üë• {inscritos.length} inscritos</p>
                                                    {!isAdmin && currentSocio && (
                                                        estaInscrito ? (
                                                            <button onClick={() => desinscribirseASalida(salida.id)} className="bg-red-600 text-white px-4 py-2 rounded text-sm hover:bg-red-700">
                                                                Desinscribirme
                                                            </button>
                                                        ) : (
                                                            <button onClick={() => inscribirseASalida(salida.id)} className="btn-primary px-4 py-2 rounded text-sm">
                                                                Inscribirme
                                                            </button>
                                                        )
                                                    )}
                                                </div>
                                            </div>
                                        );
                                    })}
                                    {salidas.length === 0 && (
                                        <div className="text-center py-12 text-gray-500">
                                            <p className="text-6xl mb-4">üö¥</p>
                                            <p>No hay salidas programadas</p>
                                            {isAdmin && <p className="text-sm mt-2">Haz clic en "Nueva Salida" para crear una</p>}
                                        </div>
                                    )}
                                </div>
                            </div>
                        )}
                        
                        {activeTab === 'tienda' && (
                            <div className="bg-white rounded-lg shadow p-6">
                                <h2 className="text-2xl font-bold mb-4">Tienda del Club</h2>
                                <div className="grid md:grid-cols-3 gap-4 mb-6">
                                    {productos.map(producto => (
                                        <div key={producto.id} className="border rounded-lg p-4">
                                            {producto.imagen ? (
                                                <img src={producto.imagen} className="w-full h-48 object-cover rounded mb-3" alt={producto.nombre}/>
                                            ) : (
                                                <div className="w-full h-48 bg-gray-200 rounded mb-3 flex items-center justify-center text-6xl">üì¶</div>
                                            )}
                                            <h3 className="font-bold">{producto.nombre}</h3>
                                            <p className="text-corp-primary font-bold text-xl">{producto.precio}‚Ç¨</p>
                                            <div className="mt-3 grid grid-cols-3 gap-2">
                                                {['XS', 'S', 'M', 'L', 'XL', 'XXL'].map(talla => {
                                                    const stockField = `stock_${talla.toLowerCase()}`;
                                                    const stock = producto[stockField];
                                                    return (
                                                        <button key={talla} onClick={() => agregarAlCarrito(producto, talla)}
                                                            disabled={stock === 0}
                                                            className={`px-2 py-1 rounded text-sm ${stock > 0 ? 'btn-primary' : 'bg-gray-300 text-gray-500 cursor-not-allowed'}`}>
                                                            {talla} ({stock})
                                                        </button>
                                                    );
                                                })}
                                            </div>
                                        </div>
                                    ))}
                                </div>
                                
                                {carrito.length > 0 && (
                                    <div className="border-t pt-6">
                                        <h3 className="font-bold mb-3">üõí Carrito ({carrito.length})</h3>
                                        {carrito.map((item, i) => (
                                            <div key={i} className="flex justify-between items-center mb-2 p-2 bg-gray-50 rounded">
                                                <span>{item.nombre} - {item.talla} - {item.precio}‚Ç¨</span>
                                                <button onClick={() => eliminarDelCarrito(i)} className="text-red-600 hover:bg-red-50 px-2 py-1 rounded">‚úï</button>
                                            </div>
                                        ))}
                                        <div className="mt-4 flex justify-between items-center">
                                            <span className="font-bold text-xl">Total: {carrito.reduce((s, i) => s + i.precio, 0)}‚Ç¨</span>
                                            <button onClick={procesarCompra} className="btn-primary px-6 py-3 rounded">Finalizar Compra</button>
                                        </div>
                                    </div>
                                )}
                            </div>
                        )}
                        
                        {activeTab === 'strava' && (
                            <div className="bg-white rounded-lg shadow p-6">
                                <h2 className="text-2xl font-bold mb-4">Integraci√≥n con Strava</h2>
                                {currentSocio?.strava_connected ? (
                                    <div>
                                        <div className="mb-4 p-4 bg-green-50 rounded">
                                            <p className="font-semibold">‚úì Conectado con Strava</p>
                                            <button onClick={sincronizarStrava} className="btn-primary px-4 py-2 rounded mt-2">üîÑ Sincronizar</button>
                                        </div>
                                        <h3 className="font-bold text-lg mb-3">Clasificaci√≥n del Club</h3>
                                        <table className="w-full">
                                            <thead className="bg-gray-100">
                                                <tr>
                                                    <th className="px-4 py-2 text-left">Pos</th>
                                                    <th className="px-4 py-2 text-left">Socio</th>
                                                    <th className="px-4 py-2 text-left">KM Mes</th>
                                                    <th className="px-4 py-2 text-left">KM A√±o</th>
                                                    <th className="px-4 py-2 text-left">Desnivel</th>
                                                    <th className="px-4 py-2 text-left">Salidas</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {stravaStats.sort((a, b) => b.km_mes - a.km_mes).map((stat, i) => (
                                                    <tr key={stat.id} className="border-b">
                                                        <td className="px-4 py-3">{i === 0 ? 'ü•á' : i === 1 ? 'ü•à' : i === 2 ? 'ü•â' : `#${i + 1}`}</td>
                                                        <td className="px-4 py-3">{stat.socios?.nombre} {stat.socios?.apellidos}</td>
                                                        <td className="px-4 py-3">{stat.km_mes} km</td>
                                                        <td className="px-4 py-3">{stat.km_ano} km</td>
                                                        <td className="px-4 py-3">{stat.desnivel_mes} m</td>
                                                        <td className="px-4 py-3">{stat.salidas_mes}</td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </div>
                                ) : (
                                    <div className="text-center">
                                        {!stravaClientId && (
                                            <div className="mb-4 p-4 bg-yellow-50 rounded">
                                                <p className="mb-2">Configura las credenciales de Strava primero</p>
                                                <button onClick={() => setMostrarConfigStrava(true)} className="btn-secondary px-4 py-2 rounded">‚öôÔ∏è Configurar</button>
                                            </div>
                                        )}
                                        {mostrarConfigStrava && (
                                            <div className="mb-4 p-4 border rounded">
                                                <h3 className="font-bold mb-3">Configurar Strava API</h3>
                                                <input type="text" placeholder="Client ID (n√∫mero)" value={stravaClientId}
                                                    onChange={(e) => setStravaClientId(e.target.value)}
                                                    className="w-full border rounded px-3 py-2 mb-2"/>
                                                <input type="password" placeholder="Client Secret" value={stravaClientSecret}
                                                    onChange={(e) => setStravaClientSecret(e.target.value)}
                                                    className="w-full border rounded px-3 py-2 mb-2"/>
                                                <button onClick={guardarCredencialesStrava} className="btn-primary px-4 py-2 rounded">üíæ Guardar</button>
                                                <p className="text-xs text-gray-500 mt-2">Obt√©n estas credenciales en strava.com/settings/api</p>
                                            </div>
                                        )}
                                        <button onClick={conectarConStrava} className="bg-orange-500 text-white px-6 py-3 rounded text-lg hover:bg-orange-600">
                                            Conectar con Strava
                                        </button>
                                    </div>
                                )}
                            </div>
                        )}
                    </main>
                    
                    <footer className="bg-corp-secondary text-white mt-12 py-8">
                        <div className="container mx-auto px-4 text-center">
                            <p>¬© 2025 Lin de Cubel - Club Ciclista</p>
                        </div>
                    </footer>
                </div>
            );
        }

        ReactDOM.render(<ClubCiclistaApp />, document.getElementById('root'));
    </script>
    
    <script>
        if ('serviceWorker' in navigator) {
            const swCode = `const CACHE='ldc-v1';self.addEventListener('install',()=>self.skipWaiting());self.addEventListener('activate',e=>e.waitUntil(clients.claim()));self.addEventListener('fetch',e=>e.respondWith(caches.match(e.request).then(r=>r||fetch(e.request).then(f=>caches.open(CACHE).then(c=>{c.put(e.request,f.clone());return f}))).catch(()=>new Response('Offline'))));`;
            const blob = new Blob([swCode], { type: 'application/javascript' });
            navigator.serviceWorker.register(URL.createObjectURL(blob)).then(() => {
                let deferredPrompt;
                window.addEventListener('beforeinstallprompt', (e) => {
                    e.preventDefault();
                    deferredPrompt = e;
                    const banner = document.createElement('div');
                    banner.style.cssText = 'position:fixed;bottom:20px;left:50%;transform:translateX(-50%);background:#a4c639;color:white;padding:15px 25px;border-radius:10px;box-shadow:0 4px 12px rgba(0,0,0,0.3);z-index:10000;display:flex;gap:15px;max-width:90%';
                    banner.innerHTML = '<span>üì± ¬øInstalar Lin de Cubel?</span><button id="install-btn" style="background:white;color:#a4c639;padding:8px 16px;border-radius:5px;border:none;font-weight:bold;cursor:pointer">Instalar</button><button id="close-btn" style="background:transparent;color:white;padding:8px;border:none;cursor:pointer">‚úï</button>';
                    document.body.appendChild(banner);
                    document.getElementById('install-btn').addEventListener('click', () => {
                        banner.style.display = 'none';
                        deferredPrompt.prompt();
                    });
                    document.getElementById('close-btn').addEventListener('click', () => banner.style.display = 'none');
                });
            });
        }
    </script>
</body>
</html>
