<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lin de Cubel - Gesti√≥n del Club</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&display=swap');
        
        body { 
            font-family: 'Orbitron', sans-serif;
            background-color: #f8faf9;
            letter-spacing: 0.02em;
        }
        
        /* Colores corporativos Lin de Cubel */
        .bg-corp-primary { background-color: #a4c639 !important; }
        .bg-corp-dark { background-color: #8fb02e !important; }
        .bg-corp-light { background-color: #b8d657 !important; }
        .bg-corp-secondary { background-color: #2d2d2d !important; }
        .bg-corp-secondary-dark { background-color: #1a1a1a !important; }
        .bg-corp-bg-light { background-color: #f0f7e6 !important; }
        .bg-corp-bg-pale { background-color: #e6f2c9 !important; }
        
        .text-corp-primary { color: #a4c639 !important; }
        .text-corp-secondary { color: #2d2d2d !important; }
        .text-corp-dark { color: #1a1a1a !important; }
        
        .border-corp-primary { border-color: #a4c639 !important; }
        .border-corp-secondary { border-color: #2d2d2d !important; }
        
        .btn-primary {
            background-color: #a4c639;
            color: white;
            transition: all 0.3s;
        }
        .btn-primary:hover {
            background-color: #8fb02e;
        }
        .btn-secondary {
            background-color: #2d2d2d;
            color: white;
            transition: all 0.3s;
        }
        .btn-secondary:hover {
            background-color: #1a1a1a;
        }
    </style>
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#a4c639">
    <meta name="description" content="Sistema de gesti√≥n del Club Ciclista Lin de Cubel">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Lin de Cubel">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 200 200'><rect fill='%23a4c639' width='200' height='200'/><circle cx='60' cy='100' r='35' fill='none' stroke='white' stroke-width='12'/><circle cx='140' cy='100' r='35' fill='none' stroke='white' stroke-width='12'/><path d='M 85 75 Q 100 60 115 75' fill='none' stroke='white' stroke-width='12' stroke-linecap='round'/></svg>">
    
    <script>
        // Manifest din√°mico inline
        const manifest = {
            name: "Lin de Cubel Club Ciclista",
            short_name: "Lin de Cubel",
            description: "Sistema de gesti√≥n del Club Ciclista Lin de Cubel",
            start_url: "./",
            display: "standalone",
            background_color: "#f8faf9",
            theme_color: "#a4c639",
            orientation: "portrait-primary",
            icons: [
                {
                    src: "data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 200 200'><rect fill='%23a4c639' width='200' height='200'/><circle cx='60' cy='100' r='35' fill='none' stroke='white' stroke-width='12'/><circle cx='140' cy='100' r='35' fill='none' stroke='white' stroke-width='12'/><path d='M 85 75 Q 100 60 115 75' fill='none' stroke='white' stroke-width='12' stroke-linecap='round'/></svg>",
                    sizes: "any",
                    type: "image/svg+xml",
                    purpose: "any maskable"
                }
            ]
        };
        
        const stringManifest = JSON.stringify(manifest);
        const blob = new Blob([stringManifest], {type: 'application/json'});
        const manifestURL = URL.createObjectURL(blob);
        document.write('<link rel="manifest" href="' + manifestURL + '">');
    </script>
</head>
<body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;

        function ClubCiclistaApp() {
            const [activeTab, setActiveTab] = useState('socios');
            const [isLoggedIn, setIsLoggedIn] = useState(false);
            const [userRole, setUserRole] = useState(''); // 'admin' o 'socio'
            const [currentUser, setCurrentUser] = useState(null); // Datos del socio logueado
            const [loginEmail, setLoginEmail] = useState('');
            const [loginPassword, setLoginPassword] = useState('');
            const [isAdmin, setIsAdmin] = useState(false);
            const [usuarioActual, setUsuarioActual] = useState({
                nombre: 'Administrador',
                rol: 'admin' // 'admin' o 'socio'
            });
            const [logoUrl, setLogoUrl] = useState(''); // Logo editable - vac√≠o para usar SVG por defecto
            const [editandoLogo, setEditandoLogo] = useState(false);
            const [mostrarNotificaciones, setMostrarNotificaciones] = useState(false);
            const [notificaciones, setNotificaciones] = useState([
                { id: 1, tipo: 'salida', mensaje: 'Nueva salida: Ruta de la Sierra el 15/02', fecha: '2025-01-27', leida: false },
                { id: 2, tipo: 'cuota', mensaje: 'Recordatorio: Cuota anual pendiente', fecha: '2025-01-25', leida: false }
            ]);
            
            // Estados para Socios
            const [socios, setSocios] = useState([
                {
                    id: 1,
                    nombre: 'Carlos',
                    apellidos: 'Garc√≠a L√≥pez',
                    dni: '12345678A',
                    telefono: '666 123 456',
                    fechaNacimiento: '1985-06-15',
                    email: 'carlos.garcia@email.com',
                    direccion: 'Calle Mayor 123, Madrid',
                    foto: '',
                    cuotaPagada: true,
                    fechaPago: '2025-01-15'
                },
                {
                    id: 2,
                    nombre: 'Ana',
                    apellidos: 'Mart√≠nez Ruiz',
                    dni: '23456789B',
                    telefono: '677 234 567',
                    fechaNacimiento: '1990-03-22',
                    email: 'ana.martinez@email.com',
                    direccion: 'Avenida Constituci√≥n 45, Zaragoza',
                    foto: '',
                    cuotaPagada: true,
                    fechaPago: '2025-01-10'
                },
                {
                    id: 3,
                    nombre: 'Juan',
                    apellidos: 'P√©rez S√°nchez',
                    dni: '34567890C',
                    telefono: '688 345 678',
                    fechaNacimiento: '1988-11-08',
                    email: 'juan.perez@email.com',
                    direccion: 'Plaza Espa√±a 7, Huesca',
                    foto: '',
                    cuotaPagada: false,
                    fechaPago: null
                },
                {
                    id: 4,
                    nombre: 'Mar√≠a',
                    apellidos: 'L√≥pez Fern√°ndez',
                    dni: '45678901D',
                    telefono: '699 456 789',
                    fechaNacimiento: '1992-07-30',
                    email: 'maria.lopez@email.com',
                    direccion: 'Calle Sol 89, Teruel',
                    foto: '',
                    cuotaPagada: true,
                    fechaPago: '2025-01-20'
                }
            ]);
            const [nuevoSocio, setNuevoSocio] = useState({
                nombre: '', apellidos: '', dni: '', telefono: '', fechaNacimiento: '',
                email: '', direccion: '', foto: '', cuotaPagada: false
            });
            const [busquedaSocio, setBusquedaSocio] = useState('');
            const [filtroCuota, setFiltroCuota] = useState('todos'); // todos, pagadas, pendientes

            // Estados para Salidas
            const [salidas, setSalidas] = useState([
                {
                    id: 1,
                    nombre: 'Ruta de la Sierra',
                    fecha: '2025-02-15',
                    distancia: '85 km',
                    desnivel: '1200 m',
                    nivel: 'Intermedio',
                    trackUrl: 'https://example.com/track1.gpx',
                    inscritos: ['Carlos Garc√≠a L√≥pez', 'Ana Mart√≠nez Ruiz'],
                    maxInscritos: 20,
                    fotos: []
                },
                {
                    id: 2,
                    nombre: 'Puerto de Monrep√≥s',
                    fecha: '2025-02-08',
                    distancia: '120 km',
                    desnivel: '2100 m',
                    nivel: 'Avanzado',
                    trackUrl: '',
                    inscritos: ['Juan P√©rez S√°nchez'],
                    maxInscritos: 15,
                    fotos: []
                },
                {
                    id: 3,
                    nombre: 'Vuelta al Embalse',
                    fecha: '2025-02-01',
                    distancia: '45 km',
                    desnivel: '350 m',
                    nivel: 'Principiante',
                    trackUrl: '',
                    inscritos: ['Carlos Garc√≠a L√≥pez', 'Ana Mart√≠nez Ruiz', 'Mar√≠a L√≥pez Fern√°ndez'],
                    maxInscritos: 25,
                    fotos: []
                }
            ]);
            const [nuevaSalida, setNuevaSalida] = useState({
                nombre: '', fecha: '', distancia: '', desnivel: '', nivel: 'Principiante', maxInscritos: 20
            });
            const [filtroNivelSalida, setFiltroNivelSalida] = useState('todos');
            const [vistaCalendario, setVistaCalendario] = useState(false);

            // Estados para Tienda
            const [productos, setProductos] = useState([
                {
                    id: 1,
                    nombre: 'Maillot Club Ciclista',
                    precio: 45,
                    stock: { XS: 5, S: 10, M: 15, L: 12, XL: 8, XXL: 3 },
                    imagen: 'https://images.unsplash.com/photo-1556906781-9a412961c28c?w=300&h=300&fit=crop'
                },
                {
                    id: 2,
                    nombre: 'Culotte Corto',
                    precio: 55,
                    stock: { XS: 3, S: 8, M: 12, L: 10, XL: 5, XXL: 2 },
                    imagen: 'https://images.unsplash.com/photo-1571333250630-f0230c320b6d?w=300&h=300&fit=crop'
                },
                {
                    id: 3,
                    nombre: 'Chaqueta T√©rmica',
                    precio: 85,
                    stock: { XS: 2, S: 5, M: 8, L: 6, XL: 4, XXL: 2 },
                    imagen: 'https://images.unsplash.com/photo-1551028719-00167b16eac5?w=300&h=300&fit=crop'
                }
            ]);
            const [carrito, setCarrito] = useState([]);
            const [historialCompras, setHistorialCompras] = useState([]);
            const [nuevoProducto, setNuevoProducto] = useState({
                nombre: '', precio: 0, imagen: '',
                stock: { XS: 0, S: 0, M: 0, L: 0, XL: 0, XXL: 0 }
            });

            // Estados para Strava
            const [stravaConnected, setStravaConnected] = useState(false);
            const [stravaAccessToken, setStravaAccessToken] = useState('');
            const [stravaAthleteData, setStravaAthleteData] = useState(null);
            const [stravaClientId, setStravaClientId] = useState(localStorage.getItem('strava_client_id') || '');
            const [stravaClientSecret, setStravaClientSecret] = useState(localStorage.getItem('strava_client_secret') || '');
            const [mostrarConfigStrava, setMostrarConfigStrava] = useState(false);
            const [estadisticasStrava, setEstadisticasStrava] = useState([
                {
                    socio: 'Carlos Garc√≠a L√≥pez',
                    kmMes: 450,
                    kmA√±o: 1250,
                    desnivelMes: 6800,
                    salidasMes: 18
                },
                {
                    socio: 'Ana Mart√≠nez Ruiz',
                    kmMes: 380,
                    kmA√±o: 980,
                    desnivelMes: 5200,
                    salidasMes: 15
                },
                {
                    socio: 'Juan P√©rez S√°nchez',
                    kmMes: 520,
                    kmA√±o: 1580,
                    desnivelMes: 7800,
                    salidasMes: 22
                }
            ]);

            // Configuraci√≥n de Strava API desde estados
            const REDIRECT_URI = window.location.origin + window.location.pathname;

            // Guardar credenciales en localStorage
            const guardarCredencialesStrava = () => {
                localStorage.setItem('strava_client_id', stravaClientId);
                localStorage.setItem('strava_client_secret', stravaClientSecret);
                setMostrarConfigStrava(false);
                alert('Credenciales guardadas correctamente. Ya puedes conectar con Strava.');
            };

            // Funciones para Socios
            const agregarSocio = () => {
                if (nuevoSocio.nombre && nuevoSocio.apellidos && nuevoSocio.dni && nuevoSocio.email) {
                    setSocios([...socios, { ...nuevoSocio, id: Date.now() }]);
                    setNuevoSocio({
                        nombre: '', apellidos: '', dni: '', telefono: '', fechaNacimiento: '',
                        email: '', direccion: '', foto: '', cuotaPagada: false
                    });
                    alert('Socio a√±adido correctamente');
                }
            };

            const handleFotoSocio = (e, socioId = null) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onloadend = () => {
                        if (socioId) {
                            // Actualizar foto de socio existente
                            setSocios(socios.map(s => 
                                s.id === socioId ? { ...s, foto: reader.result } : s
                            ));
                        } else {
                            // Foto para nuevo socio
                            setNuevoSocio({...nuevoSocio, foto: reader.result});
                        }
                    };
                    reader.readAsDataURL(file);
                }
            };

            const sociosFiltrados = socios.filter(socio => {
                // Si es socio (no admin), solo ver su propia informaci√≥n
                if (!isAdmin && currentUser) {
                    if (socio.email !== currentUser.email && socio.dni !== currentUser.dni) {
                        return false;
                    }
                }
                
                const nombreCompleto = `${socio.nombre} ${socio.apellidos}`.toLowerCase();
                const cumpleBusqueda = nombreCompleto.includes(busquedaSocio.toLowerCase()) || 
                                       socio.dni.toLowerCase().includes(busquedaSocio.toLowerCase()) ||
                                       socio.telefono.toLowerCase().includes(busquedaSocio.toLowerCase()) ||
                                       socio.email.toLowerCase().includes(busquedaSocio.toLowerCase());
                
                const cumpleFiltro = filtroCuota === 'todos' || 
                                    (filtroCuota === 'pagadas' && socio.cuotaPagada) ||
                                    (filtroCuota === 'pendientes' && !socio.cuotaPagada);
                
                return cumpleBusqueda && cumpleFiltro;
            });

            const eliminarSocio = (socioId) => {
                if (confirm('¬øEst√°s seguro de eliminar este socio?')) {
                    setSocios(socios.filter(s => s.id !== socioId));
                }
            };

            const pagarCuota = (socioId) => {
                setSocios(socios.map(s => 
                    s.id === socioId ? { ...s, cuotaPagada: true, fechaPago: new Date().toISOString().split('T')[0] } : s
                ));
                alert('Pago procesado correctamente. Cuota de 20‚Ç¨ pagada.');
            };

            const exportarSociosCSV = () => {
                const headers = ['Nombre', 'Apellidos', 'DNI', 'Tel√©fono', 'Fecha Nacimiento', 'Email', 'Direcci√≥n', 'Cuota Pagada', 'Fecha Pago'];
                const rows = sociosFiltrados.map(s => [
                    s.nombre, s.apellidos, s.dni, s.telefono, s.fechaNacimiento, s.email, s.direccion,
                    s.cuotaPagada ? 'S√≠' : 'No', s.fechaPago || '-'
                ]);
                
                let csvContent = headers.join(',') + '\n';
                rows.forEach(row => {
                    csvContent += row.map(cell => `"${cell}"`).join(',') + '\n';
                });
                
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', 'socios_lin_de_cubel.csv');
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            };

            // Funciones para Salidas
            const agregarSalida = () => {
                if (nuevaSalida.nombre && nuevaSalida.fecha) {
                    setSalidas([...salidas, { 
                        ...nuevaSalida, 
                        id: Date.now(), 
                        inscritos: [],
                        fotos: [],
                        trackUrl: ''
                    }]);
                    setNuevaSalida({
                        nombre: '', fecha: '', distancia: '', desnivel: '', nivel: 'Principiante', maxInscritos: 20
                    });
                    agregarNotificacion('salida', `Nueva salida programada: ${nuevaSalida.nombre} el ${nuevaSalida.fecha}`);
                    alert('Salida creada correctamente');
                }
            };

            const eliminarSalida = (salidaId) => {
                if (confirm('¬øEst√°s seguro de eliminar esta salida?')) {
                    setSalidas(salidas.filter(s => s.id !== salidaId));
                }
            };

            const inscribirseASalida = (salidaId, nombreSocio) => {
                const salida = salidas.find(s => s.id === salidaId);
                if (salida.inscritos.includes(nombreSocio)) {
                    alert('Ya est√°s inscrito en esta salida');
                    return;
                }
                setSalidas(salidas.map(s => {
                    if (s.id === salidaId) {
                        return { ...s, inscritos: [...s.inscritos, nombreSocio] };
                    }
                    return s;
                }));
                alert('Inscripci√≥n realizada correctamente');
            };

            const desinscribirseASalida = (salidaId, nombreSocio) => {
                setSalidas(salidas.map(s => {
                    if (s.id === salidaId) {
                        return { ...s, inscritos: s.inscritos.filter(i => i !== nombreSocio) };
                    }
                    return s;
                }));
                alert('Te has desinscrito de la salida');
            };

            const subirTrack = (salidaId, url) => {
                setSalidas(salidas.map(s => 
                    s.id === salidaId ? { ...s, trackUrl: url } : s
                ));
                alert('Track subido correctamente');
            };

            const subirFoto = (salidaId, fotoUrl) => {
                setSalidas(salidas.map(s => 
                    s.id === salidaId ? { ...s, fotos: [...s.fotos, fotoUrl] } : s
                ));
                alert('Foto subida correctamente');
            };

            const salidasFiltradas = salidas
                .filter(salida => filtroNivelSalida === 'todos' || salida.nivel === filtroNivelSalida)
                .sort((a, b) => new Date(a.fecha) - new Date(b.fecha));

            // Generar calendario del mes actual
            const generarCalendario = () => {
                const hoy = new Date();
                const a√±o = hoy.getFullYear();
                const mes = hoy.getMonth();
                const primerDia = new Date(a√±o, mes, 1).getDay();
                const ultimoDia = new Date(a√±o, mes + 1, 0).getDate();
                
                const diasSemana = ['Dom', 'Lun', 'Mar', 'Mi√©', 'Jue', 'Vie', 'S√°b'];
                const nombresMeses = ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 
                                     'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];
                
                let calendario = [];
                let semana = [];
                
                // D√≠as vac√≠os al inicio
                for (let i = 0; i < primerDia; i++) {
                    semana.push(null);
                }
                
                // D√≠as del mes
                for (let dia = 1; dia <= ultimoDia; dia++) {
                    const fecha = `${a√±o}-${String(mes + 1).padStart(2, '0')}-${String(dia).padStart(2, '0')}`;
                    const salidasDelDia = salidas.filter(s => s.fecha === fecha);
                    
                    semana.push({ dia, fecha, salidas: salidasDelDia });
                    
                    if (semana.length === 7) {
                        calendario.push(semana);
                        semana = [];
                    }
                }
                
                // Completar √∫ltima semana
                while (semana.length < 7 && semana.length > 0) {
                    semana.push(null);
                }
                if (semana.length > 0) {
                    calendario.push(semana);
                }
                
                return { calendario, nombreMes: nombresMeses[mes], a√±o, diasSemana };
            };

            // Funciones para Tienda
            const agregarAlCarrito = (producto, talla) => {
                if (producto.stock[talla] > 0) {
                    setCarrito([...carrito, { 
                        ...producto, 
                        talla, 
                        cantidad: 1,
                        productoId: producto.id // Guardar ID para actualizar stock despu√©s
                    }]);
                    alert(`${producto.nombre} (Talla ${talla}) a√±adido al carrito`);
                } else {
                    alert(`No hay stock disponible de ${producto.nombre} en talla ${talla}`);
                }
            };

            const eliminarDelCarrito = (index) => {
                setCarrito(carrito.filter((_, i) => i !== index));
            };

            const procesarCompra = () => {
                if (carrito.length > 0) {
                    // Descontar del stock
                    const productosActualizados = [...productos];
                    carrito.forEach(itemCarrito => {
                        const productoIndex = productosActualizados.findIndex(p => p.id === itemCarrito.productoId);
                        if (productoIndex >= 0) {
                            const producto = productosActualizados[productoIndex];
                            if (producto.stock[itemCarrito.talla] > 0) {
                                producto.stock[itemCarrito.talla] -= 1;
                            }
                        }
                    });
                    setProductos(productosActualizados);
                    
                    // Registrar compra
                    const compra = {
                        id: Date.now(),
                        fecha: new Date().toISOString().split('T')[0],
                        items: [...carrito],
                        total: carrito.reduce((sum, item) => sum + item.precio, 0),
                        comprador: currentUser ? `${currentUser.nombre} ${currentUser.apellidos}` : 'Admin'
                    };
                    setHistorialCompras([compra, ...historialCompras]);
                    alert('Compra procesada correctamente. Total: ' + compra.total + '‚Ç¨\n\nEl stock se ha actualizado autom√°ticamente.');
                    setCarrito([]);
                }
            };

            const agregarProducto = () => {
                if (nuevoProducto.nombre && nuevoProducto.precio > 0) {
                    const totalStock = Object.values(nuevoProducto.stock).reduce((sum, val) => sum + val, 0);
                    if (totalStock === 0) {
                        alert('Debes a√±adir stock de al menos una talla');
                        return;
                    }
                    setProductos([...productos, { ...nuevoProducto, id: Date.now() }]);
                    setNuevoProducto({
                        nombre: '', precio: 0, imagen: '',
                        stock: { XS: 0, S: 0, M: 0, L: 0, XL: 0, XXL: 0 }
                    });
                    alert('Producto a√±adido correctamente');
                }
            };

            const handleImagenProducto = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onloadend = () => {
                        setNuevoProducto({...nuevoProducto, imagen: reader.result});
                    };
                    reader.readAsDataURL(file);
                }
            };

            // Funciones para Notificaciones
            const marcarNotificacionLeida = (notifId) => {
                setNotificaciones(notificaciones.map(n => 
                    n.id === notifId ? { ...n, leida: true } : n
                ));
            };

            const eliminarNotificacion = (notifId) => {
                setNotificaciones(notificaciones.filter(n => n.id !== notifId));
            };

            const agregarNotificacion = (tipo, mensaje) => {
                const nuevaNotif = {
                    id: Date.now(),
                    tipo,
                    mensaje,
                    fecha: new Date().toISOString().split('T')[0],
                    leida: false
                };
                setNotificaciones([nuevaNotif, ...notificaciones]);
            };

            const notificacionesNoLeidas = notificaciones.filter(n => !n.leida).length;

            // Funciones de Login
            const ADMIN_PASSWORD = 'lindecubel2025'; // Contrase√±a del administrador
            
            const loginAdmin = () => {
                if (loginPassword === ADMIN_PASSWORD) {
                    setIsLoggedIn(true);
                    setUserRole('admin');
                    setIsAdmin(true);
                    setCurrentUser({ nombre: 'Administrador', rol: 'admin' });
                    setLoginPassword('');
                    alert('¬°Bienvenido Administrador!');
                } else {
                    alert('Contrase√±a incorrecta');
                }
            };
            
            const loginSocio = () => {
                const socio = socios.find(s => 
                    s.email.toLowerCase() === loginEmail.toLowerCase() || 
                    s.dni.toLowerCase() === loginEmail.toLowerCase()
                );
                
                if (socio) {
                    setIsLoggedIn(true);
                    setUserRole('socio');
                    setIsAdmin(false);
                    setCurrentUser(socio);
                    setLoginEmail('');
                    alert(`¬°Bienvenido ${socio.nombre} ${socio.apellidos}!`);
                } else {
                    alert('Socio no encontrado. Verifica tu email o DNI.');
                }
            };
            
            const logout = () => {
                setIsLoggedIn(false);
                setUserRole('');
                setIsAdmin(false);
                setCurrentUser(null);
                setActiveTab('socios');
            };

            // Funciones para Strava
            const conectarConStrava = () => {
                if (!stravaClientId) {
                    alert('Por favor, configura primero tus credenciales de Strava');
                    setMostrarConfigStrava(true);
                    return;
                }
                
                // Generar URL de autorizaci√≥n de Strava
                const scope = 'read,activity:read_all,profile:read_all';
                const authUrl = `https://www.strava.com/oauth/authorize?client_id=${stravaClientId}&response_type=code&redirect_uri=${encodeURIComponent(REDIRECT_URI)}&approval_prompt=force&scope=${scope}`;
                
                // Redirigir al usuario a Strava para autorizar
                window.location.href = authUrl;
            };

            const obtenerTokenStrava = async (code) => {
                try {
                    // Nota: Esto normalmente se har√≠a en el backend por seguridad
                    // Aqu√≠ es una demostraci√≥n simplificada
                    const response = await fetch('https://www.strava.com/oauth/token', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            client_id: stravaClientId,
                            client_secret: stravaClientSecret,
                            code: code,
                            grant_type: 'authorization_code'
                        })
                    });
                    
                    const data = await response.json();
                    
                    if (data.access_token) {
                        setStravaAccessToken(data.access_token);
                        setStravaAthleteData(data.athlete);
                        setStravaConnected(true);
                        
                        // Obtener estad√≠sticas del atleta
                        obtenerEstadisticasStrava(data.access_token);
                    }
                } catch (error) {
                    console.error('Error al obtener token de Strava:', error);
                    alert('Error al conectar con Strava. Por favor, verifica tu configuraci√≥n.');
                }
            };

            const obtenerEstadisticasStrava = async (accessToken) => {
                try {
                    // Primero obtener el ID del atleta
                    const athleteResponse = await fetch('https://www.strava.com/api/v3/athlete', {
                        headers: {
                            'Authorization': `Bearer ${accessToken}`
                        }
                    });
                    
                    if (!athleteResponse.ok) {
                        console.error('Error al obtener datos del atleta:', athleteResponse.status);
                        alert(`Error al obtener perfil de Strava: ${athleteResponse.status}`);
                        return;
                    }
                    
                    const athlete = await athleteResponse.json();
                    console.log('Datos del atleta:', athlete);
                    
                    // Obtener estad√≠sticas del atleta
                    const statsResponse = await fetch(`https://www.strava.com/api/v3/athletes/${athlete.id}/stats`, {
                        headers: {
                            'Authorization': `Bearer ${accessToken}`
                        }
                    });
                    
                    if (!statsResponse.ok) {
                        console.error('Error al obtener estad√≠sticas:', statsResponse.status);
                        alert(`Error al obtener estad√≠sticas de Strava: ${statsResponse.status}`);
                        return;
                    }
                    
                    const stats = await statsResponse.json();
                    console.log('Estad√≠sticas obtenidas:', stats);
                    
                    // Calcular datos del mes actual (√∫ltimos 30 d√≠as aproximadamente)
                    const kmMes = stats.recent_ride_totals ? Math.round(stats.recent_ride_totals.distance / 1000) : 0;
                    const kmA√±o = stats.ytd_ride_totals ? Math.round(stats.ytd_ride_totals.distance / 1000) : 0;
                    const desnivelMes = stats.recent_ride_totals ? Math.round(stats.recent_ride_totals.elevation_gain) : 0;
                    const salidasMes = stats.recent_ride_totals ? stats.recent_ride_totals.count : 0;
                    
                    // Crear nuevo objeto con las estad√≠sticas
                    const nuevasEstadisticas = {
                        socio: `${athlete.firstname} ${athlete.lastname}`,
                        kmMes: kmMes,
                        kmA√±o: kmA√±o,
                        desnivelMes: desnivelMes,
                        salidasMes: salidasMes
                    };
                    
                    console.log('Nuevas estad√≠sticas creadas:', nuevasEstadisticas);
                    
                    // Verificar si el usuario ya est√° en la lista
                    const usuarioExistente = estadisticasStrava.findIndex(e => 
                        e.socio.toLowerCase() === nuevasEstadisticas.socio.toLowerCase()
                    );
                    
                    if (usuarioExistente >= 0) {
                        // Actualizar estad√≠sticas existentes
                        const nuevaLista = [...estadisticasStrava];
                        nuevaLista[usuarioExistente] = nuevasEstadisticas;
                        setEstadisticasStrava(nuevaLista);
                        console.log('Estad√≠sticas actualizadas para usuario existente');
                    } else {
                        // Agregar al principio de la lista
                        setEstadisticasStrava([nuevasEstadisticas, ...estadisticasStrava]);
                        console.log('Nuevo usuario agregado a estad√≠sticas');
                    }
                    
                    alert(`¬°Sincronizaci√≥n exitosa!\nKm mes: ${kmMes}\nKm a√±o: ${kmA√±o}\nDesnivel: ${desnivelMes}m\nSalidas: ${salidasMes}`);
                    
                } catch (error) {
                    console.error('Error detallado al obtener estad√≠sticas de Strava:', error);
                    alert(`Error al sincronizar con Strava: ${error.message}\n\nRevisa la consola del navegador para m√°s detalles.`);
                }
            };

            const desconectarStrava = () => {
                setStravaConnected(false);
                setStravaAccessToken('');
                setStravaAthleteData(null);
            };

            // Verificar si hay un c√≥digo de autorizaci√≥n en la URL
            React.useEffect(() => {
                const urlParams = new URLSearchParams(window.location.search);
                const code = urlParams.get('code');
                
                if (code && !stravaConnected) {
                    obtenerTokenStrava(code);
                    // Limpiar la URL
                    window.history.replaceState({}, document.title, window.location.pathname);
                }
            }, []);

            const eliminarProducto = (productoId) => {
                if (confirm('¬øEst√°s seguro de eliminar este producto?')) {
                    setProductos(productos.filter(p => p.id !== productoId));
                }
            };

            // Renderizado de secciones
            const renderSocios = () => (
                <div className="space-y-6">
                    {/* Dashboard de estad√≠sticas */}
                    <div className="grid md:grid-cols-4 gap-4">
                        <div className="bg-corp-primary text-white rounded-lg shadow-lg p-6">
                            <div className="flex items-center justify-between">
                                <div>
                                    <p className="text-white opacity-90 text-sm mb-1">Total Socios</p>
                                    <p className="text-3xl font-bold">{socios.length}</p>
                                </div>
                                <div className="bg-white bg-opacity-20 rounded-full p-3">
                                    <span className="text-3xl">üë•</span>
                                </div>
                            </div>
                        </div>
                        
                        <div className="bg-corp-secondary text-white rounded-lg shadow-lg p-6">
                            <div className="flex items-center justify-between">
                                <div>
                                    <p className="text-white opacity-90 text-sm mb-1">Cuotas Pagadas</p>
                                    <p className="text-3xl font-bold">{socios.filter(s => s.cuotaPagada).length}</p>
                                </div>
                                <div className="bg-white bg-opacity-20 rounded-full p-3">
                                    <span className="text-3xl">‚úì</span>
                                </div>
                            </div>
                        </div>
                        
                        <div className="bg-corp-light text-gray-800 rounded-lg shadow-lg p-6">
                            <div className="flex items-center justify-between">
                                <div>
                                    <p className="text-gray-800 opacity-90 text-sm mb-1">Cuotas Pendientes</p>
                                    <p className="text-3xl font-bold text-gray-800">{socios.filter(s => !s.cuotaPagada).length}</p>
                                </div>
                                <div className="bg-white bg-opacity-30 rounded-full p-3">
                                    <span className="text-3xl">‚è∞</span>
                                </div>
                            </div>
                        </div>
                        
                        <div className="bg-corp-dark text-white rounded-lg shadow-lg p-6">
                            <div className="flex items-center justify-between">
                                <div>
                                    <p className="text-white opacity-90 text-sm mb-1">Ingresos Cuotas</p>
                                    <p className="text-3xl font-bold">{socios.filter(s => s.cuotaPagada).length * 20}‚Ç¨</p>
                                </div>
                                <div className="bg-white bg-opacity-20 rounded-full p-3">
                                    <span className="text-3xl">üí∞</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div className="bg-white rounded-lg shadow p-6">
                        <div className="flex justify-between items-center mb-4">
                            <h2 className="text-2xl font-bold text-gray-800">Gesti√≥n de Socios</h2>
                            {isAdmin && (
                                <button
                                    onClick={exportarSociosCSV}
                                    className="btn-secondary px-4 py-2 rounded text-sm"
                                >
                                    üì• Exportar CSV
                                </button>
                            )}
                        </div>
                        
                        {/* Informaci√≥n de pago */}
                        <div className="mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                            <h3 className="font-semibold text-lg mb-3 text-blue-900">üí∞ Informaci√≥n de Pago de Cuota Anual</h3>
                            <div className="grid md:grid-cols-2 gap-4 text-sm">
                                <div>
                                    <p className="font-semibold text-gray-700 mb-2">Cuota anual: <span className="text-corp-primary text-xl">20‚Ç¨</span></p>
                                    <p className="text-gray-600 mb-1"><strong>üè¶ Transferencia bancaria:</strong></p>
                                    <p className="font-mono text-sm bg-white px-3 py-2 rounded border">ES07 3059 0021 4429 2850 5722</p>
                                    <p className="text-xs text-gray-500 mt-1">Titular: Club Ciclista Lin de Cubel</p>
                                </div>
                                <div>
                                    <p className="font-semibold text-gray-700 mb-2">Concepto a indicar:</p>
                                    <p className="bg-white px-3 py-2 rounded border text-gray-700">
                                        <strong>Cuota [Tu Nombre y Apellidos]</strong>
                                    </p>
                                    <p className="text-xs text-gray-500 mt-2">
                                        ‚ö†Ô∏è Importante: Tras realizar el pago, contacta con el administrador para que actualice tu estado de cuota en la aplicaci√≥n.
                                    </p>
                                </div>
                            </div>
                        </div>
                        
                        {isAdmin && (
                            <div className="mb-6 p-4 bg-corp-bg-light rounded-lg">
                                <h3 className="font-semibold mb-3 text-lg">A√±adir Nuevo Socio</h3>
                                <div className="grid grid-cols-2 gap-3">
                                    <input
                                        type="text"
                                        placeholder="Nombre"
                                        value={nuevoSocio.nombre}
                                        onChange={(e) => setNuevoSocio({...nuevoSocio, nombre: e.target.value})}
                                        className="border rounded px-3 py-2"
                                    />
                                    <input
                                        type="text"
                                        placeholder="Apellidos"
                                        value={nuevoSocio.apellidos}
                                        onChange={(e) => setNuevoSocio({...nuevoSocio, apellidos: e.target.value})}
                                        className="border rounded px-3 py-2"
                                    />
                                    <input
                                        type="text"
                                        placeholder="DNI"
                                        value={nuevoSocio.dni}
                                        onChange={(e) => setNuevoSocio({...nuevoSocio, dni: e.target.value})}
                                        className="border rounded px-3 py-2"
                                    />
                                    <input
                                        type="tel"
                                        placeholder="Tel√©fono m√≥vil"
                                        value={nuevoSocio.telefono}
                                        onChange={(e) => setNuevoSocio({...nuevoSocio, telefono: e.target.value})}
                                        className="border rounded px-3 py-2"
                                    />
                                    <input
                                        type="date"
                                        value={nuevoSocio.fechaNacimiento}
                                        onChange={(e) => setNuevoSocio({...nuevoSocio, fechaNacimiento: e.target.value})}
                                        className="border rounded px-3 py-2"
                                    />
                                    <input
                                        type="email"
                                        placeholder="Email"
                                        value={nuevoSocio.email}
                                        onChange={(e) => setNuevoSocio({...nuevoSocio, email: e.target.value})}
                                        className="border rounded px-3 py-2"
                                    />
                                    <input
                                        type="text"
                                        placeholder="Direcci√≥n Postal"
                                        value={nuevoSocio.direccion}
                                        onChange={(e) => setNuevoSocio({...nuevoSocio, direccion: e.target.value})}
                                        className="border rounded px-3 py-2 col-span-2"
                                    />
                                    <div className="col-span-2">
                                        <label className="block text-sm font-semibold mb-2">Foto del socio:</label>
                                        <input
                                            type="file"
                                            accept="image/*"
                                            onChange={handleFotoSocio}
                                            className="border rounded px-3 py-2 w-full"
                                        />
                                        {nuevoSocio.foto && (
                                            <img src={nuevoSocio.foto} alt="Preview" className="mt-2 h-32 w-32 object-cover rounded-full" />
                                        )}
                                    </div>
                                </div>
                                <button
                                    onClick={agregarSocio}
                                    className="mt-3 btn-primary px-6 py-2 rounded"
                                >
                                    A√±adir Socio
                                </button>
                            </div>
                        )}

                        <div className="mb-4 flex gap-3">
                            <input
                                type="text"
                                placeholder="üîç Buscar por nombre, DNI, tel√©fono o email..."
                                value={busquedaSocio}
                                onChange={(e) => setBusquedaSocio(e.target.value)}
                                className="flex-1 border rounded px-4 py-2"
                            />
                            <select
                                value={filtroCuota}
                                onChange={(e) => setFiltroCuota(e.target.value)}
                                className="border rounded px-4 py-2"
                            >
                                <option value="todos">Todas las cuotas</option>
                                <option value="pagadas">Cuotas pagadas</option>
                                <option value="pendientes">Cuotas pendientes</option>
                            </select>
                        </div>

                        <div className="overflow-x-auto">
                            <table className="w-full">
                                <thead className="bg-gray-100">
                                    <tr>
                                        <th className="px-4 py-2 text-left">Foto</th>
                                        <th className="px-4 py-2 text-left">Nombre</th>
                                        <th className="px-4 py-2 text-left">DNI</th>
                                        <th className="px-4 py-2 text-left">Tel√©fono</th>
                                        <th className="px-4 py-2 text-left">Email</th>
                                        <th className="px-4 py-2 text-left">Direcci√≥n</th>
                                        <th className="px-4 py-2 text-left">Cuota</th>
                                        <th className="px-4 py-2 text-left">Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {sociosFiltrados.length === 0 ? (
                                        <tr>
                                            <td colSpan="8" className="px-4 py-8 text-center text-gray-500">
                                                No se encontraron socios con los criterios de b√∫squeda
                                            </td>
                                        </tr>
                                    ) : (
                                        sociosFiltrados.map(socio => (
                                        <tr key={socio.id} className="border-b">
                                            <td className="px-4 py-3">
                                                {socio.foto ? (
                                                    <img src={socio.foto} alt={socio.nombre} className="h-12 w-12 object-cover rounded-full" />
                                                ) : (
                                                    <div className="h-12 w-12 bg-gray-200 rounded-full flex items-center justify-center text-gray-400">
                                                        <span className="text-xl">üë§</span>
                                                    </div>
                                                )}
                                            </td>
                                            <td className="px-4 py-3">{socio.nombre} {socio.apellidos}</td>
                                            <td className="px-4 py-3">{socio.dni}</td>
                                            <td className="px-4 py-3">{socio.telefono}</td>
                                            <td className="px-4 py-3">{socio.email}</td>
                                            <td className="px-4 py-3">{socio.direccion}</td>
                                            <td className="px-4 py-3">
                                                {socio.cuotaPagada ? (
                                                    <span className="bg-green-100 text-green-800 px-2 py-1 rounded text-sm">
                                                        Pagada ({socio.fechaPago})
                                                    </span>
                                                ) : (
                                                    <span className="bg-red-100 text-red-800 px-2 py-1 rounded text-sm">
                                                        Pendiente
                                                    </span>
                                                )}
                                            </td>
                                            <td className="px-4 py-3">
                                                <div className="flex gap-2 flex-wrap">
                                                    <label className="btn-secondary px-3 py-1 rounded text-sm cursor-pointer">
                                                        üì∑ Foto
                                                        <input
                                                            type="file"
                                                            accept="image/*"
                                                            onChange={(e) => handleFotoSocio(e, socio.id)}
                                                            className="hidden"
                                                        />
                                                    </label>
                                                    {!socio.cuotaPagada && (
                                                        <button
                                                            onClick={() => pagarCuota(socio.id)}
                                                            className="btn-primary px-3 py-1 rounded text-sm"
                                                        >
                                                            Pagar Cuota (20‚Ç¨)
                                                        </button>
                                                    )}
                                                    {isAdmin && (
                                                        <button
                                                            onClick={() => eliminarSocio(socio.id)}
                                                            className="bg-red-600 text-white px-3 py-1 rounded text-sm hover:bg-red-700"
                                                        >
                                                            Eliminar
                                                        </button>
                                                    )}
                                                </div>
                                            </td>
                                        </tr>
                                    ))
                                    )}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            );

            const renderSalidas = () => (
                <div className="space-y-6">
                    <div className="bg-white rounded-lg shadow p-6">
                        <h2 className="text-2xl font-bold mb-4 text-gray-800">Salidas Programadas</h2>
                        
                        {isAdmin && (
                            <div className="mb-6 p-4 bg-corp-bg-light rounded-lg">
                                <h3 className="font-semibold mb-3 text-lg">Crear Nueva Salida</h3>
                                <div className="grid grid-cols-2 gap-3">
                                    <input
                                        type="text"
                                        placeholder="Nombre de la ruta"
                                        value={nuevaSalida.nombre}
                                        onChange={(e) => setNuevaSalida({...nuevaSalida, nombre: e.target.value})}
                                        className="border rounded px-3 py-2"
                                    />
                                    <input
                                        type="date"
                                        value={nuevaSalida.fecha}
                                        onChange={(e) => setNuevaSalida({...nuevaSalida, fecha: e.target.value})}
                                        className="border rounded px-3 py-2"
                                    />
                                    <input
                                        type="text"
                                        placeholder="Distancia (ej: 85 km)"
                                        value={nuevaSalida.distancia}
                                        onChange={(e) => setNuevaSalida({...nuevaSalida, distancia: e.target.value})}
                                        className="border rounded px-3 py-2"
                                    />
                                    <input
                                        type="text"
                                        placeholder="Desnivel (ej: 1200 m)"
                                        value={nuevaSalida.desnivel}
                                        onChange={(e) => setNuevaSalida({...nuevaSalida, desnivel: e.target.value})}
                                        className="border rounded px-3 py-2"
                                    />
                                    <select
                                        value={nuevaSalida.nivel}
                                        onChange={(e) => setNuevaSalida({...nuevaSalida, nivel: e.target.value})}
                                        className="border rounded px-3 py-2"
                                    >
                                        <option>Principiante</option>
                                        <option>Intermedio</option>
                                        <option>Avanzado</option>
                                    </select>
                                </div>
                                <button
                                    onClick={agregarSalida}
                                    className="mt-3 btn-primary px-6 py-2 rounded"
                                >
                                    Crear Salida
                                </button>
                            </div>
                        )}

                        <div className="mb-4 flex justify-between items-center">
                            <div className="flex gap-3 items-center">
                                <select
                                    value={filtroNivelSalida}
                                    onChange={(e) => setFiltroNivelSalida(e.target.value)}
                                    className="border rounded px-4 py-2"
                                >
                                    <option value="todos">Todos los niveles</option>
                                    <option value="Principiante">Principiante</option>
                                    <option value="Intermedio">Intermedio</option>
                                    <option value="Avanzado">Avanzado</option>
                                </select>
                                <span className="text-gray-600 text-sm">
                                    Mostrando {salidasFiltradas.length} de {salidas.length} salidas
                                </span>
                            </div>
                            <div className="flex gap-2">
                                <button
                                    onClick={() => setVistaCalendario(false)}
                                    className={`px-4 py-2 rounded ${!vistaCalendario ? 'btn-primary' : 'bg-gray-200'}`}
                                >
                                    üìã Lista
                                </button>
                                <button
                                    onClick={() => setVistaCalendario(true)}
                                    className={`px-4 py-2 rounded ${vistaCalendario ? 'btn-primary' : 'bg-gray-200'}`}
                                >
                                    üìÖ Calendario
                                </button>
                            </div>
                        </div>

                        {vistaCalendario ? (
                            // Vista de Calendario
                            <div className="bg-white rounded-lg p-4">
                                {(() => {
                                    const { calendario, nombreMes, a√±o, diasSemana } = generarCalendario();
                                    return (
                                        <>
                                            <h3 className="text-xl font-bold text-center mb-4">{nombreMes} {a√±o}</h3>
                                            <div className="grid grid-cols-7 gap-2">
                                                {diasSemana.map(dia => (
                                                    <div key={dia} className="text-center font-semibold text-gray-600 py-2">
                                                        {dia}
                                                    </div>
                                                ))}
                                                {calendario.map((semana, idxSemana) => (
                                                    semana.map((dia, idxDia) => (
                                                        <div 
                                                            key={`${idxSemana}-${idxDia}`}
                                                            className={`border rounded p-2 min-h-24 ${
                                                                dia ? 'bg-white hover:bg-gray-50' : 'bg-gray-100'
                                                            } ${dia && dia.salidas.length > 0 ? 'border-corp-primary border-2' : ''}`}
                                                        >
                                                            {dia && (
                                                                <>
                                                                    <div className="font-semibold text-gray-700 mb-1">
                                                                        {dia.dia}
                                                                    </div>
                                                                    {dia.salidas.map(salida => (
                                                                        <div 
                                                                            key={salida.id}
                                                                            className="text-xs bg-corp-bg-pale text-corp-secondary px-1 py-1 rounded mb-1 cursor-pointer hover:bg-corp-primary hover:text-white"
                                                                            title={`${salida.nombre} - ${salida.distancia}`}
                                                                        >
                                                                            üö¥ {salida.nombre.substring(0, 15)}{salida.nombre.length > 15 ? '...' : ''}
                                                                        </div>
                                                                    ))}
                                                                </>
                                                            )}
                                                        </div>
                                                    ))
                                                ))}
                                            </div>
                                        </>
                                    );
                                })()}
                            </div>
                        ) : (
                            // Vista de Lista
                            <div className="grid gap-4">
                            {salidasFiltradas.map(salida => (
                                <div key={salida.id} className="border rounded-lg p-4 hover:shadow-md transition">
                                    <div className="flex justify-between items-start mb-3">
                                        <div>
                                            <div className="flex items-center gap-2">
                                                <h3 className="text-xl font-semibold text-gray-800">{salida.nombre}</h3>
                                                {new Date(salida.fecha) < new Date() && (
                                                    <span className="bg-gray-300 text-gray-700 px-2 py-1 rounded text-xs">
                                                        Finalizada
                                                    </span>
                                                )}
                                                {new Date(salida.fecha) >= new Date() && new Date(salida.fecha) <= new Date(Date.now() + 7*24*60*60*1000) && (
                                                    <span className="bg-corp-primary text-white px-2 py-1 rounded text-xs animate-pulse">
                                                        Pr√≥ximamente
                                                    </span>
                                                )}
                                            </div>
                                            <p className="text-gray-600">üìÖ {salida.fecha}</p>
                                        </div>
                                        <span className={`px-3 py-1 rounded text-sm ${
                                            salida.nivel === 'Principiante' ? 'bg-green-100 text-green-800' :
                                            salida.nivel === 'Intermedio' ? 'bg-yellow-100 text-yellow-800' :
                                            'bg-red-100 text-red-800'
                                        }`}>
                                            {salida.nivel}
                                        </span>
                                    </div>
                                    
                                    <div className="grid grid-cols-3 gap-4 mb-3 text-sm">
                                        <div>üìè <strong>Distancia:</strong> {salida.distancia}</div>
                                        <div>‚õ∞Ô∏è <strong>Desnivel:</strong> {salida.desnivel}</div>
                                        <div>üë• <strong>Inscritos:</strong> {salida.inscritos.length}</div>
                                    </div>

                                    {salida.trackUrl && (
                                        <div className="mb-3">
                                            <a href={salida.trackUrl} className="text-corp-primary hover:underline text-sm">
                                                üìä Descargar Track GPX
                                            </a>
                                        </div>
                                    )}

                                    <div className="mb-3">
                                        <button
                                            onClick={() => inscribirseASalida(salida.id, socios[0]?.nombre + ' ' + socios[0]?.apellidos)}
                                            className="btn-primary px-4 py-2 rounded text-sm mr-2"
                                        >
                                            Inscribirme
                                        </button>
                                        {salida.inscritos.includes(socios[0]?.nombre + ' ' + socios[0]?.apellidos) && (
                                            <button
                                                onClick={() => desinscribirseASalida(salida.id, socios[0]?.nombre + ' ' + socios[0]?.apellidos)}
                                                className="bg-gray-600 text-white px-4 py-2 rounded text-sm hover:bg-gray-700 mr-2"
                                            >
                                                Desinscribirme
                                            </button>
                                        )}
                                        {isAdmin && (
                                            <>
                                                <button
                                                    onClick={() => {
                                                        const url = prompt('URL del track GPX:');
                                                        if (url) subirTrack(salida.id, url);
                                                    }}
                                                    className="btn-secondary px-4 py-2 rounded text-sm mr-2"
                                                >
                                                    Subir Track
                                                </button>
                                                <button
                                                    onClick={() => {
                                                        const url = prompt('URL de la foto:');
                                                        if (url) subirFoto(salida.id, url);
                                                    }}
                                                    className="btn-primary px-4 py-2 rounded text-sm mr-2"
                                                >
                                                    Subir Foto
                                                </button>
                                                <button
                                                    onClick={() => eliminarSalida(salida.id)}
                                                    className="bg-red-600 text-white px-4 py-2 rounded text-sm hover:bg-red-700"
                                                >
                                                    Eliminar Salida
                                                </button>
                                            </>
                                        )}
                                    </div>

                                    {salida.inscritos.length > 0 && (
                                        <div className="mb-3">
                                            <p className="text-sm font-semibold mb-1">Inscritos:</p>
                                            <div className="flex flex-wrap gap-2">
                                                {salida.inscritos.map((inscrito, idx) => (
                                                    <span key={idx} className="bg-corp-bg-pale text-corp-secondary px-2 py-1 rounded text-xs">
                                                        {inscrito}
                                                    </span>
                                                ))}
                                            </div>
                                        </div>
                                    )}

                                    {salida.fotos.length > 0 && (
                                        <div>
                                            <p className="text-sm font-semibold mb-2">Galer√≠a de Fotos:</p>
                                            <div className="grid grid-cols-4 gap-2">
                                                {salida.fotos.map((foto, idx) => (
                                                    <img key={idx} src={foto} alt={`Foto ${idx + 1}`} className="w-full h-24 object-cover rounded" />
                                                ))}
                                            </div>
                                        </div>
                                    )}
                                </div>
                            ))}
                        </div>
                        )}
                    </div>
                </div>
            );

            const renderTienda = () => (
                <div className="space-y-6">
                    <div className="bg-white rounded-lg shadow p-6">
                        <h2 className="text-2xl font-bold mb-4 text-gray-800">Tienda del Club</h2>
                        
                        {/* Estad√≠sticas de ventas */}
                        {historialCompras.length > 0 && (
                            <div className="grid md:grid-cols-3 gap-4 mb-6">
                                <div className="bg-corp-bg-pale rounded-lg p-4">
                                    <p className="text-sm text-gray-600 mb-1">Total Ventas</p>
                                    <p className="text-2xl font-bold text-corp-primary">
                                        {historialCompras.reduce((sum, c) => sum + c.total, 0)}‚Ç¨
                                    </p>
                                </div>
                                <div className="bg-corp-bg-light rounded-lg p-4">
                                    <p className="text-sm text-gray-600 mb-1">Pedidos Realizados</p>
                                    <p className="text-2xl font-bold text-corp-secondary">
                                        {historialCompras.length}
                                    </p>
                                </div>
                                <div className="bg-corp-secondary text-white rounded-lg p-4">
                                    <p className="text-sm text-white opacity-90 mb-1">Productos Vendidos</p>
                                    <p className="text-2xl font-bold">
                                        {historialCompras.reduce((sum, c) => sum + c.items.length, 0)}
                                    </p>
                                </div>
                            </div>
                        )}
                        
                        {isAdmin && (
                            <div className="mb-6 p-4 bg-corp-bg-light rounded-lg">
                                <h3 className="font-semibold mb-3 text-lg">A√±adir Nuevo Producto</h3>
                                <div className="grid grid-cols-2 gap-3">
                                    <input
                                        type="text"
                                        placeholder="Nombre del producto"
                                        value={nuevoProducto.nombre}
                                        onChange={(e) => setNuevoProducto({...nuevoProducto, nombre: e.target.value})}
                                        className="border rounded px-3 py-2"
                                    />
                                    <input
                                        type="number"
                                        placeholder="Precio (‚Ç¨)"
                                        value={nuevoProducto.precio || ''}
                                        onChange={(e) => setNuevoProducto({...nuevoProducto, precio: parseFloat(e.target.value)})}
                                        className="border rounded px-3 py-2"
                                    />
                                    <div className="col-span-2">
                                        <label className="block text-sm font-semibold mb-2">Foto del producto:</label>
                                        <input
                                            type="file"
                                            accept="image/*"
                                            onChange={handleImagenProducto}
                                            className="border rounded px-3 py-2 w-full"
                                        />
                                        {nuevoProducto.imagen && (
                                            <img src={nuevoProducto.imagen} alt="Preview" className="mt-2 h-32 object-cover rounded" />
                                        )}
                                    </div>
                                    <div className="col-span-2">
                                        <p className="text-sm mb-2 font-semibold">Stock por tallas:</p>
                                        <div className="grid grid-cols-6 gap-2">
                                            {['XS', 'S', 'M', 'L', 'XL', 'XXL'].map(talla => (
                                                <input
                                                    key={talla}
                                                    type="number"
                                                    placeholder={talla}
                                                    value={nuevoProducto.stock[talla] || ''}
                                                    onChange={(e) => setNuevoProducto({
                                                        ...nuevoProducto, 
                                                        stock: { ...nuevoProducto.stock, [talla]: parseInt(e.target.value) || 0 }
                                                    })}
                                                    className="border rounded px-2 py-1 text-center"
                                                />
                                            ))}
                                        </div>
                                    </div>
                                </div>
                                <button
                                    onClick={agregarProducto}
                                    className="mt-3 btn-secondary px-6 py-2 rounded"
                                >
                                    A√±adir Producto
                                </button>
                            </div>
                        )}
                        
                        <div className="grid md:grid-cols-3 gap-6 mb-6">
                            {productos.map(producto => (
                                <div key={producto.id} className="border rounded-lg p-4 hover:shadow-lg transition">
                                    {producto.imagen ? (
                                        <img src={producto.imagen} alt={producto.nombre} className="w-full h-48 object-cover rounded mb-3" />
                                    ) : (
                                        <div className="w-full h-48 bg-gray-200 rounded mb-3 flex items-center justify-center text-gray-400">
                                            <span className="text-4xl">üì¶</span>
                                        </div>
                                    )}
                                    <h3 className="text-lg font-semibold mb-2">{producto.nombre}</h3>
                                    <p className="text-2xl font-bold text-corp-primary mb-3">{producto.precio}‚Ç¨</p>
                                    
                                    <div className="mb-3">
                                        <p className="text-sm font-semibold mb-2">Stock disponible:</p>
                                        <div className="grid grid-cols-3 gap-2">
                                            {Object.entries(producto.stock).map(([talla, cantidad]) => (
                                                <button
                                                    key={talla}
                                                    onClick={() => agregarAlCarrito(producto, talla)}
                                                    disabled={cantidad === 0}
                                                    className={`px-3 py-2 rounded text-sm ${
                                                        cantidad > 0 
                                                            ? 'bg-corp-bg-pale hover:bg-corp-primary hover:text-white text-corp-secondary' 
                                                            : 'bg-gray-200 text-gray-500 cursor-not-allowed'
                                                    }`}
                                                >
                                                    {talla} ({cantidad})
                                                </button>
                                            ))}
                                        </div>
                                    </div>

                                    {isAdmin && (
                                        <button
                                            onClick={() => eliminarProducto(producto.id)}
                                            className="w-full bg-red-600 text-white px-3 py-2 rounded text-sm hover:bg-red-700"
                                        >
                                            Eliminar Producto
                                        </button>
                                    )}
                                </div>
                            ))}
                        </div>

                        {carrito.length > 0 && (
                            <div className="bg-yellow-50 rounded-lg p-4 mb-6">
                                <h3 className="font-semibold mb-3 text-lg">üõí Carrito de Compra</h3>
                                {carrito.map((item, idx) => (
                                    <div key={idx} className="flex justify-between items-center mb-2 pb-2 border-b">
                                        <div>
                                            <span className="font-semibold">{item.nombre}</span>
                                            <span className="text-gray-600 text-sm ml-2">- Talla {item.talla}</span>
                                        </div>
                                        <div className="flex items-center gap-3">
                                            <span className="font-semibold">{item.precio}‚Ç¨</span>
                                            <button
                                                onClick={() => eliminarDelCarrito(idx)}
                                                className="text-red-600 hover:text-red-800 text-sm"
                                            >
                                                ‚úï
                                            </button>
                                        </div>
                                    </div>
                                ))}
                                <div className="border-t pt-3 mt-3 flex justify-between items-center">
                                    <span className="text-lg font-bold">Total:</span>
                                    <span className="text-2xl font-bold text-corp-primary">
                                        {carrito.reduce((sum, item) => sum + item.precio, 0)}‚Ç¨
                                    </span>
                                </div>
                                <button
                                    onClick={procesarCompra}
                                    className="w-full mt-3 btn-primary px-6 py-3 rounded-lg font-semibold"
                                >
                                    Finalizar Compra
                                </button>
                            </div>
                        )}

                        {historialCompras.length > 0 && (
                            <div className="bg-gray-50 rounded-lg p-4">
                                <h3 className="font-semibold mb-3 text-lg">üì¶ Historial de Compras</h3>
                                {historialCompras.map(compra => (
                                    <div key={compra.id} className="bg-white rounded p-3 mb-2 border">
                                        <div className="flex justify-between items-center mb-2">
                                            <span className="text-sm text-gray-600">üìÖ {compra.fecha}</span>
                                            <span className="font-bold text-corp-primary">{compra.total}‚Ç¨</span>
                                        </div>
                                        <div className="text-sm">
                                            {compra.items.map((item, idx) => (
                                                <span key={idx} className="text-gray-600">
                                                    {item.nombre} ({item.talla}){idx < compra.items.length - 1 ? ', ' : ''}
                                                </span>
                                            ))}
                                        </div>
                                    </div>
                                ))}
                            </div>
                        )}
                    </div>
                </div>
            );

            const renderStrava = () => (
                <div className="space-y-6">
                    <div className="bg-white rounded-lg shadow p-6">
                        <h2 className="text-2xl font-bold mb-4 text-gray-800">Integraci√≥n con Strava</h2>
                        
                        {!stravaConnected ? (
                            <div className="text-center py-8">
                                <div className="mb-4">
                                    <svg className="w-24 h-24 mx-auto text-orange-500" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M15.387 17.944l-2.089-4.116h-3.065L15.387 24l5.15-10.172h-3.066m-7.008-5.599l2.836 5.598h4.172L10.463 0l-7 13.828h4.169"/>
                                    </svg>
                                </div>
                                <h3 className="text-xl font-semibold mb-2">Conecta con Strava</h3>
                                <p className="text-gray-600 mb-4">
                                    Conecta tu cuenta de Strava para comparar estad√≠sticas con otros socios del club
                                </p>
                                
                                {!stravaClientId ? (
                                    <div className="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4 max-w-2xl mx-auto">
                                        <p className="text-sm text-yellow-800 mb-2 font-semibold">‚öôÔ∏è Configuraci√≥n necesaria:</p>
                                        <ol className="text-sm text-yellow-700 text-left list-decimal list-inside space-y-1 mb-3">
                                            <li>Ve a <a href="https://www.strava.com/settings/api" target="_blank" className="text-blue-600 underline">strava.com/settings/api</a></li>
                                            <li>Crea una nueva aplicaci√≥n (o usa una existente)</li>
                                            <li>Copia el "Client ID" y "Client Secret"</li>
                                            <li>Haz clic en el bot√≥n "‚öôÔ∏è Configurar Credenciales" abajo</li>
                                            <li>Pega tus credenciales y guarda</li>
                                        </ol>
                                        <button
                                            onClick={() => setMostrarConfigStrava(true)}
                                            className="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700"
                                        >
                                            ‚öôÔ∏è Configurar Credenciales
                                        </button>
                                    </div>
                                ) : null}
                                
                                {mostrarConfigStrava && (
                                    <div className="bg-white border rounded-lg p-6 mb-4 max-w-2xl mx-auto shadow-lg">
                                        <h4 className="font-semibold mb-3">Configurar Credenciales de Strava</h4>
                                        <div className="space-y-3 text-left">
                                            <div>
                                                <label className="block text-sm font-semibold mb-1">Client ID:</label>
                                                <input
                                                    type="text"
                                                    value={stravaClientId}
                                                    onChange={(e) => setStravaClientId(e.target.value)}
                                                    placeholder="Ejemplo: 123456"
                                                    className="w-full border rounded px-3 py-2"
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-sm font-semibold mb-1">Client Secret:</label>
                                                <input
                                                    type="password"
                                                    value={stravaClientSecret}
                                                    onChange={(e) => setStravaClientSecret(e.target.value)}
                                                    placeholder="Ejemplo: abc123def456..."
                                                    className="w-full border rounded px-3 py-2"
                                                />
                                            </div>
                                            <div className="flex gap-2">
                                                <button
                                                    onClick={guardarCredencialesStrava}
                                                    className="btn-primary px-4 py-2 rounded"
                                                >
                                                    üíæ Guardar
                                                </button>
                                                <button
                                                    onClick={() => setMostrarConfigStrava(false)}
                                                    className="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600"
                                                >
                                                    Cancelar
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                )}
                                
                                <div className="flex gap-2 justify-center">
                                    <button
                                        onClick={conectarConStrava}
                                        className="bg-orange-500 text-white px-6 py-3 rounded-lg hover:bg-orange-600 font-semibold"
                                    >
                                        Conectar con Strava
                                    </button>
                                    {stravaClientId && (
                                        <button
                                            onClick={() => setMostrarConfigStrava(true)}
                                            className="bg-gray-500 text-white px-4 py-3 rounded-lg hover:bg-gray-600"
                                        >
                                            ‚öôÔ∏è
                                        </button>
                                    )}
                                </div>
                            </div>
                        ) : (
                            <div>
                                <div className="flex items-center justify-between mb-6 p-4 bg-corp-bg-light rounded-lg">
                                    <div className="flex items-center">
                                        <svg className="w-8 h-8 text-orange-500 mr-3" fill="currentColor" viewBox="0 0 24 24">
                                            <path d="M15.387 17.944l-2.089-4.116h-3.065L15.387 24l5.15-10.172h-3.066m-7.008-5.599l2.836 5.598h4.172L10.463 0l-7 13.828h4.169"/>
                                        </svg>
                                        <div>
                                            <span className="font-semibold">Conectado con Strava</span>
                                            {stravaAthleteData && (
                                                <p className="text-sm text-gray-600">
                                                    {stravaAthleteData.firstname} {stravaAthleteData.lastname}
                                                </p>
                                            )}
                                        </div>
                                    </div>
                                    <div className="flex gap-2">
                                        <button
                                            onClick={() => obtenerEstadisticasStrava(stravaAccessToken)}
                                            className="bg-orange-500 text-white px-4 py-2 rounded text-sm hover:bg-orange-600"
                                        >
                                            üîÑ Sincronizar
                                        </button>
                                        <button
                                            onClick={desconectarStrava}
                                            className="text-red-600 hover:text-red-800 text-sm"
                                        >
                                            Desconectar
                                        </button>
                                    </div>
                                </div>

                                <h3 className="text-lg font-semibold mb-4">Clasificaci√≥n del Club - Mes Actual</h3>
                                <div className="overflow-x-auto">
                                    <table className="w-full">
                                        <thead className="bg-gray-100">
                                            <tr>
                                                <th className="px-4 py-2 text-left">Posici√≥n</th>
                                                <th className="px-4 py-2 text-left">Socio</th>
                                                <th className="px-4 py-2 text-left">KM Mes</th>
                                                <th className="px-4 py-2 text-left">KM A√±o</th>
                                                <th className="px-4 py-2 text-left">Desnivel Mes</th>
                                                <th className="px-4 py-2 text-left">Salidas Mes</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {[...estadisticasStrava].sort((a, b) => b.kmMes - a.kmMes).map((stat, idx) => (
                                                <tr key={idx} className="border-b hover:bg-gray-50">
                                                    <td className="px-4 py-3">
                                                        <span className={`font-bold text-lg ${
                                                            idx === 0 ? 'text-yellow-600' :
                                                            idx === 1 ? 'text-gray-500' :
                                                            idx === 2 ? 'text-orange-600' : 'text-gray-800'
                                                        }`}>
                                                            {idx === 0 ? 'ü•á' : idx === 1 ? 'ü•à' : idx === 2 ? 'ü•â' : `#${idx + 1}`}
                                                        </span>
                                                    </td>
                                                    <td className="px-4 py-3 font-semibold">{stat.socio}</td>
                                                    <td className="px-4 py-3 text-corp-primary font-bold">{stat.kmMes} km</td>
                                                    <td className="px-4 py-3">{stat.kmA√±o} km</td>
                                                    <td className="px-4 py-3">{stat.desnivelMes} m</td>
                                                    <td className="px-4 py-3">{stat.salidasMes}</td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>

                                <div className="mt-6 grid md:grid-cols-3 gap-4">
                                    <div className="bg-corp-bg-pale rounded-lg p-4">
                                        <p className="text-sm text-gray-600 mb-1">Total KM Club (Mes)</p>
                                        <p className="text-3xl font-bold text-corp-primary">
                                            {estadisticasStrava.reduce((sum, s) => sum + s.kmMes, 0)} km
                                        </p>
                                    </div>
                                    <div className="bg-corp-bg-light rounded-lg p-4">
                                        <p className="text-sm text-gray-600 mb-1">Total Desnivel (Mes)</p>
                                        <p className="text-3xl font-bold text-corp-dark">
                                            {estadisticasStrava.reduce((sum, s) => sum + s.desnivelMes, 0)} m
                                        </p>
                                    </div>
                                    <div className="bg-corp-secondary text-white rounded-lg p-4">
                                        <p className="text-sm text-white opacity-90 mb-1">Total Salidas (Mes)</p>
                                        <p className="text-3xl font-bold">
                                            {estadisticasStrava.reduce((sum, s) => sum + s.salidasMes, 0)}
                                        </p>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );

            return (
                <div className="min-h-screen bg-gray-50">
                    {!isLoggedIn ? (
                        // Pantalla de Login
                        <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-corp-primary to-corp-dark">
                            <div className="bg-white rounded-lg shadow-2xl p-8 max-w-md w-full mx-4">
                                <div className="text-center mb-8">
                                    <svg width="100" height="100" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg" className="mx-auto mb-4">
                                        <circle cx="60" cy="100" r="35" fill="none" stroke="#a4c639" strokeWidth="12"/>
                                        <circle cx="140" cy="100" r="35" fill="none" stroke="#a4c639" strokeWidth="12"/>
                                        <path d="M 85 75 Q 100 60 115 75" fill="none" stroke="#a4c639" strokeWidth="12" strokeLinecap="round"/>
                                    </svg>
                                    <h1 className="text-3xl font-bold text-corp-secondary mb-2">LIN DE CUBEL</h1>
                                    <p className="text-gray-600">Sistema de Gesti√≥n del Club</p>
                                </div>
                                
                                <div className="space-y-4">
                                    {/* Login Administrador */}
                                    <div className="border-2 border-corp-primary rounded-lg p-6">
                                        <h2 className="text-xl font-bold mb-4 text-corp-secondary">üîê Administrador</h2>
                                        <input
                                            type="password"
                                            placeholder="Contrase√±a"
                                            value={loginPassword}
                                            onChange={(e) => setLoginPassword(e.target.value)}
                                            onKeyPress={(e) => e.key === 'Enter' && loginAdmin()}
                                            className="w-full border rounded px-4 py-3 mb-3"
                                        />
                                        <button
                                            onClick={loginAdmin}
                                            className="w-full btn-primary px-4 py-3 rounded font-semibold"
                                        >
                                            Entrar como Administrador
                                        </button>
                                    </div>
                                    
                                    {/* Login Socio */}
                                    <div className="border-2 border-gray-300 rounded-lg p-6">
                                        <h2 className="text-xl font-bold mb-4 text-corp-secondary">üë§ Socio</h2>
                                        <input
                                            type="text"
                                            placeholder="Email o DNI"
                                            value={loginEmail}
                                            onChange={(e) => setLoginEmail(e.target.value)}
                                            onKeyPress={(e) => e.key === 'Enter' && loginSocio()}
                                            className="w-full border rounded px-4 py-3 mb-3"
                                        />
                                        <button
                                            onClick={loginSocio}
                                            className="w-full btn-secondary px-4 py-3 rounded font-semibold"
                                        >
                                            Entrar como Socio
                                        </button>
                                    </div>
                                </div>
                                
                                <p className="text-xs text-gray-500 text-center mt-6">
                                    ¬© 2025 Club Ciclista Lin de Cubel
                                </p>
                            </div>
                        </div>
                    ) : (
                        // Aplicaci√≥n principal (cuando est√° logueado)
                        <>
                    {/* Header */}
                    <header className="bg-corp-primary text-white shadow-lg">
                        <div className="container mx-auto px-4 py-4">
                            <div className="flex items-center justify-between">
                                <div className="flex items-center gap-4">
                                    {/* Logo editable */}
                                    {editandoLogo ? (
                                        <div className="flex items-center gap-2">
                                            <div>
                                                <label className="btn-secondary px-4 py-2 rounded text-sm cursor-pointer">
                                                    üìÅ Seleccionar Logo
                                                    <input
                                                        type="file"
                                                        accept="image/*"
                                                        onChange={(e) => {
                                                            const file = e.target.files[0];
                                                            if (file) {
                                                                const reader = new FileReader();
                                                                reader.onloadend = () => {
                                                                    setLogoUrl(reader.result);
                                                                };
                                                                reader.readAsDataURL(file);
                                                            }
                                                        }}
                                                        className="hidden"
                                                    />
                                                </label>
                                            </div>
                                            <button
                                                onClick={() => setEditandoLogo(false)}
                                                className="btn-primary px-4 py-2 rounded text-sm"
                                            >
                                                ‚úì Guardar
                                            </button>
                                            <button
                                                onClick={() => {
                                                    setLogoUrl('');
                                                    setEditandoLogo(false);
                                                }}
                                                className="bg-gray-600 text-white px-4 py-2 rounded text-sm hover:bg-gray-700"
                                            >
                                                üóëÔ∏è Usar logo por defecto
                                            </button>
                                        </div>
                                    ) : (
                                        <>
                                            <div className="relative group">
                                                {logoUrl ? (
                                                    <img 
                                                        src={logoUrl} 
                                                        alt="Logo Lin de Cubel" 
                                                        className="h-20 w-20 object-contain bg-white rounded-lg p-2"
                                                    />
                                                ) : (
                                                    <svg 
                                                        width="80" 
                                                        height="80" 
                                                        viewBox="0 0 200 200" 
                                                        xmlns="http://www.w3.org/2000/svg"
                                                        className="bg-white rounded-lg p-2"
                                                    >
                                                        <circle cx="60" cy="100" r="35" fill="none" stroke="#a4c639" strokeWidth="12"/>
                                                        <circle cx="140" cy="100" r="35" fill="none" stroke="#a4c639" strokeWidth="12"/>
                                                        <path d="M 85 75 Q 100 60 115 75" fill="none" stroke="#a4c639" strokeWidth="12" strokeLinecap="round"/>
                                                    </svg>
                                                )}
                                                {isAdmin && (
                                                    <button
                                                        onClick={() => setEditandoLogo(true)}
                                                        className="absolute top-0 right-0 bg-corp-secondary text-white rounded-full w-6 h-6 text-xs opacity-0 group-hover:opacity-100 transition"
                                                        title="Editar logo"
                                                    >
                                                        ‚úé
                                                    </button>
                                                )}
                                            </div>
                                            <div>
                                                <h1 className="text-3xl font-bold text-corp-secondary" style={{letterSpacing: '0.1em'}}>LIN DE CUBEL</h1>
                                                <p className="text-corp-secondary mt-1 text-sm opacity-90">Sistema de Gesti√≥n del Club</p>
                                            </div>
                                        </>
                                    )}
                                </div>
                                <div className="flex items-center gap-3">
                                    {/* Notificaciones */}
                                    <div className="relative">
                                        <button
                                            onClick={() => setMostrarNotificaciones(!mostrarNotificaciones)}
                                            className="relative btn-secondary px-3 py-2 rounded"
                                        >
                                            üîî
                                            {notificacionesNoLeidas > 0 && (
                                                <span className="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center">
                                                    {notificacionesNoLeidas}
                                                </span>
                                            )}
                                        </button>

                                        {/* Dropdown de notificaciones */}
                                        {mostrarNotificaciones && (
                                            <div className="absolute right-0 mt-2 w-80 bg-white rounded-lg shadow-xl z-50 max-h-96 overflow-y-auto">
                                                <div className="p-3 border-b bg-corp-secondary text-white font-semibold">
                                                    Notificaciones ({notificacionesNoLeidas} sin leer)
                                                </div>
                                                {notificaciones.length === 0 ? (
                                                    <div className="p-4 text-center text-gray-500">
                                                        No hay notificaciones
                                                    </div>
                                                ) : (
                                                    notificaciones.map(notif => (
                                                        <div 
                                                            key={notif.id} 
                                                            className={`p-3 border-b hover:bg-gray-50 ${!notif.leida ? 'bg-blue-50' : ''}`}
                                                        >
                                                            <div className="flex justify-between items-start mb-1">
                                                                <span className={`text-xs px-2 py-1 rounded ${
                                                                    notif.tipo === 'salida' ? 'bg-corp-bg-pale text-corp-secondary' :
                                                                    notif.tipo === 'cuota' ? 'bg-yellow-100 text-yellow-800' :
                                                                    'bg-gray-100 text-gray-800'
                                                                }`}>
                                                                    {notif.tipo === 'salida' ? 'üö¥ Salida' : 
                                                                     notif.tipo === 'cuota' ? 'üí∞ Cuota' : 'üì¢ Info'}
                                                                </span>
                                                                <button
                                                                    onClick={() => eliminarNotificacion(notif.id)}
                                                                    className="text-gray-400 hover:text-red-600 text-sm"
                                                                >
                                                                    ‚úï
                                                                </button>
                                                            </div>
                                                            <p className="text-sm text-gray-800 mb-1">{notif.mensaje}</p>
                                                            <div className="flex justify-between items-center">
                                                                <span className="text-xs text-gray-500">{notif.fecha}</span>
                                                                {!notif.leida && (
                                                                    <button
                                                                        onClick={() => marcarNotificacionLeida(notif.id)}
                                                                        className="text-xs text-corp-primary hover:underline"
                                                                    >
                                                                        Marcar como le√≠da
                                                                    </button>
                                                                )}
                                                            </div>
                                                        </div>
                                                    ))
                                                )}
                                            </div>
                                        )}
                                    </div>

                                    {/* Bot√≥n editar logo */}
                                    {!editandoLogo && isAdmin && (
                                        <button
                                            onClick={() => setEditandoLogo(true)}
                                            className="btn-secondary px-4 py-2 rounded text-sm"
                                        >
                                            ‚úé Editar Logo
                                        </button>
                                    )}
                                    
                                    {/* Usuario y Logout */}
                                    <div className="flex items-center gap-3">
                                        <div className="text-right">
                                            <p className="text-sm font-semibold text-corp-secondary">
                                                {currentUser ? `${currentUser.nombre} ${currentUser.apellidos || ''}` : 'Usuario'}
                                            </p>
                                            <p className="text-xs text-gray-600">
                                                {userRole === 'admin' ? 'üîê Administrador' : 'üë§ Socio'}
                                            </p>
                                        </div>
                                        <button
                                            onClick={logout}
                                            className="bg-red-600 text-white px-4 py-2 rounded text-sm hover:bg-red-700"
                                        >
                                            Cerrar Sesi√≥n
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </header>

                    {/* Navigation */}
                    <nav className="bg-white shadow-md sticky top-0 z-10">
                        <div className="container mx-auto px-4">
                            <div className="flex space-x-1">
                                <button
                                    onClick={() => setActiveTab('socios')}
                                    className={`px-6 py-4 font-semibold transition ${
                                        activeTab === 'socios'
                                            ? 'bg-corp-primary text-white border-corp-secondary'
                                            : 'text-gray-600 hover:text-gray-800'
                                    }`}
                                    style={activeTab === 'socios' ? {borderBottom: '4px solid #2d2d2d'} : {}}
                                >
                                    üë• Socios
                                </button>
                                <button
                                    onClick={() => setActiveTab('salidas')}
                                    className={`px-6 py-4 font-semibold transition ${
                                        activeTab === 'salidas'
                                            ? 'bg-corp-primary text-white border-corp-secondary'
                                            : 'text-gray-600 hover:text-gray-800'
                                    }`}
                                    style={activeTab === 'salidas' ? {borderBottom: '4px solid #2d2d2d'} : {}}
                                >
                                    üö¥ Salidas
                                </button>
                                <button
                                    onClick={() => setActiveTab('tienda')}
                                    className={`px-6 py-4 font-semibold transition ${
                                        activeTab === 'tienda'
                                            ? 'bg-corp-primary text-white border-corp-secondary'
                                            : 'text-gray-600 hover:text-gray-800'
                                    }`}
                                    style={activeTab === 'tienda' ? {borderBottom: '4px solid #2d2d2d'} : {}}
                                >
                                    üõçÔ∏è Tienda
                                </button>
                                <button
                                    onClick={() => setActiveTab('strava')}
                                    className={`px-6 py-4 font-semibold transition ${
                                        activeTab === 'strava'
                                            ? 'bg-corp-primary text-white border-corp-secondary'
                                            : 'text-gray-600 hover:text-gray-800'
                                    }`}
                                    style={activeTab === 'strava' ? {borderBottom: '4px solid #2d2d2d'} : {}}
                                >
                                    üìä Strava
                                </button>
                            </div>
                        </div>
                    </nav>

                    {/* Content */}
                    <main className="container mx-auto px-4 py-8">
                        {activeTab === 'socios' && renderSocios()}
                        {activeTab === 'salidas' && renderSalidas()}
                        {activeTab === 'tienda' && renderTienda()}
                        {activeTab === 'strava' && renderStrava()}
                    </main>

                    {/* Footer */}
                    <footer className="bg-corp-secondary text-white mt-12">
                        <div className="container mx-auto px-4 py-8">
                            <div className="grid md:grid-cols-3 gap-8">
                                <div>
                                    <h3 className="font-bold text-lg mb-3">Lin de Cubel</h3>
                                    <p className="text-gray-300 text-sm">
                                        Club ciclista comprometido con el deporte, la naturaleza y la comunidad.
                                    </p>
                                </div>
                                <div>
                                    <h3 className="font-bold text-lg mb-3">Contacto</h3>
                                    <p className="text-gray-300 text-sm">üìß info@lindecubel.com</p>
                                    <p className="text-gray-300 text-sm">üì± +34 123 456 789</p>
                                </div>
                                <div>
                                    <h3 className="font-bold text-lg mb-3">S√≠guenos</h3>
                                    <div className="flex gap-4">
                                        <a href="#" className="text-gray-300 hover:text-corp-primary transition">Facebook</a>
                                        <a href="#" className="text-gray-300 hover:text-corp-primary transition">Instagram</a>
                                        <a href="#" className="text-gray-300 hover:text-corp-primary transition">Strava</a>
                                    </div>
                                </div>
                            </div>
                            <div className="border-t border-gray-700 mt-6 pt-6 text-center text-gray-400 text-sm">
                                ¬© 2025 Lin de Cubel - Todos los derechos reservados
                            </div>
                        </div>
                    </footer>
                    </>
                    )}
                </div>
            );
        }

        ReactDOM.render(<ClubCiclistaApp />, document.getElementById('root'));
    </script>
    
    <!-- Service Worker para PWA -->
    <script>
        if ('serviceWorker' in navigator) {
            // Crear service worker inline
            const swCode = `
                const CACHE_NAME = 'lin-de-cubel-v1';
                
                self.addEventListener('install', (event) => {
                    console.log('Service Worker installing.');
                    self.skipWaiting();
                });
                
                self.addEventListener('activate', (event) => {
                    console.log('Service Worker activating.');
                    event.waitUntil(clients.claim());
                });
                
                self.addEventListener('fetch', (event) => {
                    event.respondWith(
                        caches.match(event.request).then((response) => {
                            return response || fetch(event.request).then((fetchResponse) => {
                                return caches.open(CACHE_NAME).then((cache) => {
                                    cache.put(event.request, fetchResponse.clone());
                                    return fetchResponse;
                                });
                            });
                        }).catch(() => {
                            // Offline fallback
                            return new Response('Offline - Lin de Cubel', {
                                headers: { 'Content-Type': 'text/plain' }
                            });
                        })
                    );
                });
            `;
            
            const blob = new Blob([swCode], { type: 'application/javascript' });
            const swURL = URL.createObjectURL(blob);
            
            navigator.serviceWorker.register(swURL).then((registration) => {
                console.log('Service Worker registrado:', registration);
                
                // Mostrar banner de instalaci√≥n personalizado
                let deferredPrompt;
                window.addEventListener('beforeinstallprompt', (e) => {
                    e.preventDefault();
                    deferredPrompt = e;
                    
                    // Mostrar banner personalizado
                    const banner = document.createElement('div');
                    banner.style.cssText = `
                        position: fixed;
                        bottom: 20px;
                        left: 50%;
                        transform: translateX(-50%);
                        background: #a4c639;
                        color: white;
                        padding: 15px 25px;
                        border-radius: 10px;
                        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                        z-index: 10000;
                        font-family: 'Orbitron', sans-serif;
                        display: flex;
                        align-items: center;
                        gap: 15px;
                        max-width: 90%;
                    `;
                    
                    banner.innerHTML = `
                        <span>üì± ¬øInstalar Lin de Cubel como app?</span>
                        <button id="install-btn" style="background: white; color: #a4c639; padding: 8px 16px; border-radius: 5px; border: none; font-weight: bold; cursor: pointer;">
                            Instalar
                        </button>
                        <button id="close-btn" style="background: transparent; color: white; padding: 8px; border: none; cursor: pointer; font-size: 20px;">
                            ‚úï
                        </button>
                    `;
                    
                    document.body.appendChild(banner);
                    
                    document.getElementById('install-btn').addEventListener('click', () => {
                        banner.style.display = 'none';
                        deferredPrompt.prompt();
                        deferredPrompt.userChoice.then((choiceResult) => {
                            if (choiceResult.outcome === 'accepted') {
                                console.log('Usuario acept√≥ instalar la app');
                            }
                            deferredPrompt = null;
                        });
                    });
                    
                    document.getElementById('close-btn').addEventListener('click', () => {
                        banner.style.display = 'none';
                    });
                });
            }).catch((error) => {
                console.error('Error registrando Service Worker:', error);
            });
        }
    </script>
</body>
</html>